Model {
  Name			  "advisor_ess_options"
  Version		  2.20
  SimParamPage		  Solver
  SampleTimeColors	  off
  InvariantConstants	  off
  WideVectorLines	  off
  ShowLineWidths	  off
  StartTime		  "0.0"
  StopTime		  "500"
  Solver		  ode1
  RelTol		  "1e-3"
  AbsTol		  "auto"
  Refine		  "1"
  MaxStep		  "auto"
  InitialStep		  "auto"
  FixedStep		  "1"
  MaxOrder		  5
  OutputOption		  RefineOutputTimes
  OutputTimes		  "[]"
  LoadExternalInput	  off
  ExternalInput		  "[t, u]"
  SaveTime		  on
  TimeSaveName		  "tout"
  SaveState		  off
  StateSaveName		  "xout"
  SaveOutput		  on
  OutputSaveName	  "yout"
  LoadInitialState	  off
  InitialState		  "xInitial"
  SaveFinalState	  off
  FinalStateName	  "xFinal"
  LimitMaxRows		  off
  MaxRows		  "1000"
  Decimation		  "1"
  AlgebraicLoopMsg	  warning
  MinStepSizeMsg	  warning
  UnconnectedInputMsg	  warning
  UnconnectedOutputMsg	  warning
  UnconnectedLineMsg	  warning
  ConsistencyChecking	  off
  ZeroCross		  on
  SimulationMode	  normal
  RTWSystemTargetFile	  "grt.tlc"
  RTWInlineParameters	  off
  RTWPlaceOutputsASAP	  off
  RTWRetainRTWFile	  off
  RTWTemplateMakefile	  "grt_default_tmf"
  RTWMakeCommand	  "make_rtw"
  RTWGenerateCodeOnly	  off
  ExtModeMexFile	  "ext_comm"
  ExtModeBatchMode	  off
  BlockDefaults {
    Orientation		    right
    ForegroundColor	    black
    BackgroundColor	    white
    DropShadow		    off
    NamePlacement	    normal
    FontName		    "Helvetica"
    FontSize		    10
    FontWeight		    normal
    FontAngle		    normal
    ShowName		    on
  }
  AnnotationDefaults {
    HorizontalAlignment	    center
    VerticalAlignment	    middle
    ForegroundColor	    black
    BackgroundColor	    white
    DropShadow		    off
    FontName		    "Helvetica"
    FontSize		    10
    FontWeight		    normal
    FontAngle		    normal
  }
  LineDefaults {
    FontName		    "Helvetica"
    FontSize		    9
    FontWeight		    normal
    FontAngle		    normal
  }
  System {
    Name		    "advisor_ess_options"
    Location		    [414, 109, 815, 690]
    Open		    on
    ToolBar		    on
    StatusBar		    on
    ScreenColor		    white
    PaperOrientation	    landscape
    PaperPositionMode	    auto
    PaperType		    usletter
    PaperUnits		    inches
    Block {
      BlockType		      SubSystem
      Name		      "energy\nstorage <ess>"
      Ports		      [1, 1, 0, 0, 0]
      Position		      [120, 74, 160, 156]
      ShowPortLabels	      off
      System {
	Name			"energy\nstorage <ess>"
	Location		[24, 74, 797, 536]
	Open			off
	ToolBar			off
	StatusBar		off
	ScreenColor		white
	PaperOrientation	landscape
	PaperPositionMode	auto
	PaperType		usletter
	PaperUnits		inches
	Block {
	  BlockType		  Inport
	  Name			  "power req'd\ninto bus (W)"
	  Position		  [60, 150, 80, 170]
	  FontName		  "Arial"
	  Port			  "1"
	  PortWidth		  "-1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "Block NOTES"
	  Ports			  [0, 0, 0, 0, 0]
	  Position		  [560, 355, 616, 395]
	  BackgroundColor	  green
	  ShowName		  off
	  ShowPortLabels	  on
	  MaskDisplay		  "disp('Block\\nNOTES')"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  none
	  MaskIconUnits		  autoscale
	  System {
	    Name		    "Block NOTES"
	    Location		    [252, 540, 737, 845]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Annotation {
	      Position		      [242, 146]
	      Text		      "This block models the energy storage sy"
"stem as an SOC-dependent voltage\nin series with an SOC- and current directio"
"n-dependent internal resistance.\nSOC is computed assuming that A-h capacity "
"is constant, but limited\nsuch that a minimum voltage is never exceeded (repl"
"acing the \nprevious Peukert relationship which underpredicted battery capaci"
"ty).\n\nDischarge power is limited here so as not to bring the bus (battery p"
"ack) voltage below\nthe minimum controller voltage or the minimum battery vol"
"tage and so as to allow \nthe solution of the quadratic eq'n for discharge cu"
"rrent.\n\nCharge current is limited to ensure the voltage does not exceed a m"
"aximum\nvoltage\n\nPositive current is discharge current in the convention us"
"ed here.\nPower loss is computed as I*R+losses due to Coulombic (in)efficienc"
"y.\n\nThermal modeling of the battery performance is modeled in the\nOCV, Rin"
"t, and capacity."
	    }
	  }
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const"
	  Position		  [520, 60, 590, 80]
	  Orientation		  down
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "enable_stop"
	}
	Block {
	  BlockType		  Fcn
	  Name			  "Fcn"
	  Position		  [340, 264, 370, 286]
	  ShowName		  off
	  Expr			  "u[1]*u[1]*u[2]-u[1]*u[3]*(1-u(4))*(u[1]<0)"
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <cs>1"
	  Position		  [295, 25, 375, 45]
	  GotoTag		  "ess_max_pwr"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <mc>, <gc>, <sdo>"
	  Position		  [330, 200, 410, 220]
	  GotoTag		  "bus_voltage"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <sdo>, <cs>"
	  Position		  [150, 89, 195, 111]
	  GotoTag		  "SOC"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Memory
	  Name			  "Memory"
	  Position		  [515, 245, 530, 265]
	  ShowName		  off
	  X0			  "amb_tmp"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Mux
	  Name			  "Mux"
	  Ports			  [4, 1, 0, 0, 0]
	  Position		  [305, 259, 325, 291]
	  Inputs		  "4"
	}
	Block {
	  BlockType		  Product
	  Name			  "Product"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [330, 158, 360, 182]
	  ShowName		  off
	  FontName		  "Arial"
	  Inputs		  "2"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "SOC\nalgorithm"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [330, 96, 360, 129]
	  FontName		  "Arial"
	  ShowPortLabels	  off
	  System {
	    Name		    "SOC\nalgorithm"
	    Location		    [61, 651, 841, 923]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "(A)"
	      Position		      [15, 35, 35, 55]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "tmp\n(C)"
	      Position		      [20, 125, 40, 145]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "(sec->hrs)"
	      Position		      [265, 43, 330, 77]
	      Gain		      "1/3600"
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "0 <= SOC <= 1"
	      Position		      [650, 121, 680, 139]
	      UpperLimit	      "1"
	      LowerLimit	      "0"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "A-h\nremaining"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [505, 85, 525, 105]
	      Inputs		      "-+"
	    }
	    Block {
	      BlockType		      Integrator
	      Name		      "Ah used"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [425, 50, 445, 70]
	      ExternalReset	      none
	      InitialConditionSource  external
	      InitialCondition	      "(1-ess_init_soc)*ess_max_ah_cap"
	      LimitOutput	      off
	      UpperSaturationLimit    "inf"
	      LowerSaturationLimit    "-inf"
	      ShowSaturationPort      off
	      ShowStatePort	      off
	      AbsoluteTolerance	      "auto"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Fcn"
	      Position		      [500, 150, 540, 170]
	      ShowName		      off
	      Expr		      "1/u"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Fcn1"
	      Position		      [285, 96, 385, 114]
	      ShowName		      off
	      Expr		      "(1-ess_init_soc)*u"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "SOC"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [580, 118, 610, 142]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Switch"
	      Position		      [205, 35, 235, 85]
	      ShowName		      off
	      Threshold		      "0"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "adjusted A"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [135, 63, 165, 87]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "coul eff"
	      Position		      [75, 88, 105, 112]
	      InputValues	      "ess_tmp"
	      OutputValues	      "ess_coulombic_eff"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "max cap"
	      Position		      [200, 128, 230, 152]
	      InputValues	      "ess_tmp"
	      OutputValues	      "ess_max_ah_cap"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "SOC1"
	      Position		      [720, 120, 740, 140]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Fcn1"
	      SrcPort		      1
	      Points		      [20, 0]
	      DstBlock		      "Ah used"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "max cap"
	      SrcPort		      1
	      Points		      [30, 0]
	      Branch {
		Points			[0, -35]
		DstBlock		"Fcn1"
		DstPort			1
	      }
	      Branch {
		Points			[170, 0; 0, -30; 50, 0]
		Branch {
		  DstBlock		  "Fcn"
		  DstPort		  1
		}
		Branch {
		  Points		  [5, 0]
		  DstBlock		  "A-h\nremaining"
		  DstPort		  2
		}
	      }
	    }
	    Line {
	      SrcBlock		      "adjusted A"
	      SrcPort		      1
	      DstBlock		      "Switch"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "coul eff"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "adjusted A"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "tmp\n(C)"
	      SrcPort		      1
	      Points		      [15, 0]
	      Branch {
		DstBlock		"coul eff"
		DstPort			1
	      }
	      Branch {
		Points			[125, 0]
		DstBlock		"max cap"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "0 <= SOC <= 1"
	      SrcPort		      1
	      DstBlock		      "SOC1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "A-h\nremaining"
	      SrcPort		      1
	      Points		      [35, 0]
	      DstBlock		      "SOC"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "0 <= SOC <= 1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Fcn"
	      SrcPort		      1
	      Points		      [20, 0]
	      DstBlock		      "SOC"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Ah used"
	      SrcPort		      1
	      Points		      [40, 0]
	      DstBlock		      "A-h\nremaining"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "(sec->hrs)"
	      SrcPort		      1
	      Points		      [75, 0]
	      DstBlock		      "Ah used"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Switch"
	      SrcPort		      1
	      DstBlock		      "(sec->hrs)"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "(A)"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[0, 25]
		DstBlock		"adjusted A"
		DstPort			1
	      }
	      Branch {
		Points			[130, 0]
		Branch {
		  DstBlock		  "Switch"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, 15]
		  DstBlock		  "Switch"
		  DstPort		  2
		}
	      }
	    }
	    Annotation {
	      Position		      [533, 207]
	      Text		      "SOC=(Max Ah capacity-Ah used)/Max Ah ca"
"pacity"
	    }
	  }
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS1"
	  Position		  [339, 305, 421, 320]
	  Orientation		  down
	  NamePlacement		  alternate
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_pwr_loss_a"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS2"
	  Position		  [560, 248, 630, 262]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_mod_tmp"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS3"
	  Position		  [560, 268, 630, 282]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_air_tmp"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS4"
	  Position		  [560, 289, 635, 301]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_air_th_pwr"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace8"
	  Position		  [45, 255, 115, 275]
	  Orientation		  left
	  VariableName		  "ess_pwr_out_r"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace9"
	  Position		  [415, 114, 490, 136]
	  VariableName		  "ess_pwr_out_a"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "compute\ncurrent"
	  Ports			  [3, 2, 0, 0, 0]
	  Position		  [230, 141, 260, 199]
	  ShowPortLabels	  off
	  System {
	    Name		    "compute\ncurrent"
	    Location		    [49, 557, 908, 954]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "Voc"
	      Position		      [155, 80, 175, 100]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "Rint"
	      Position		      [155, 130, 175, 150]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "limited output\npower (W)"
	      Position		      [155, 30, 175, 50]
	      Port		      "3"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>4"
	      Position		      [725, 208, 830, 232]
	      GotoTag		      "ess_maxV_limited"
	      TagVisibility	      global
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Ibty=(Voc-(Voc^2-4RPbty)^.5)\n       --"
"---------------------------\n(2*R)"
	      Position		      [340, 79, 370, 101]
	      Expr		      "(u[2]-(u[2]^2-4*u[1]*u[3])^.5)/(2*u[3])"
	    }
	    Block {
	      BlockType		      Logic
	      Name		      "Logical\nOperator1"
	      Ports		      [1, 1, 0, 0, 0]
	      Position		      [680, 208, 710, 232]
	      ShowName		      off
	      Operator		      NOT
	      Inputs		      "1"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux3"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [570, 313, 590, 347]
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux4"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [245, 16, 265, 164]
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux5"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [250, 186, 270, 274]
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [685, 14, 760, 36]
	      VariableName	      "ess_current"
	      Buffer		      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Voc-I*R"
	      Position		      [625, 319, 705, 341]
	      Expr		      "u[2]-u[1]*u[3]"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess max voltage*#batts"
	      Position		      [25, 220, 190, 240]
	      FontName		      "Arial"
	      Value		      "ess_max_volts*ess_module_num"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "iabs min=(Voc-Vmax)/R"
	      Position		      [340, 164, 370, 186]
	      Expr		      "(u(1)-u(2))/u(3)"
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "limit current based on \nmax voltage du"
"ring charge"
	      Position		      [575, 125, 605, 155]
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "min charge current\nnot exceeded"
	      Position		      [455, 122, 485, 153]
	      Operator		      ">"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "I_"
	      Position		      [710, 130, 730, 150]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "V_"
	      Position		      [730, 320, 750, 340]
	      Port		      "2"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Logical\nOperator1"
	      SrcPort		      1
	      DstBlock		      "Goto <sdo>4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess max voltage*#batts"
	      SrcPort		      1
	      DstBlock		      "Mux5"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Mux5"
	      SrcPort		      1
	      Points		      [20, 0; 0, -55]
	      DstBlock		      "iabs min=(Voc-Vmax)/R"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux4"
	      SrcPort		      1
	      DstBlock		      "Ibty=(Voc-(Voc^2-4RPbty)^.5)\n       --"
"---------------------------\n(2*R)"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Voc-I*R"
	      SrcPort		      1
	      DstBlock		      "V_"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux3"
	      SrcPort		      1
	      DstBlock		      "Voc-I*R"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "min charge current\nnot exceeded"
	      SrcPort		      1
	      Points		      [30, 0]
	      Branch {
		Points			[0, 80]
		DstBlock		"Logical\nOperator1"
		DstPort			1
	      }
	      Branch {
		DstBlock		"limit current based on \nmax voltage "
"during charge"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "limit current based on \nmax voltage du"
"ring charge"
	      SrcPort		      1
	      Points		      [50, 0]
	      Branch {
		Points			[0, 160; -105, 0]
		DstBlock		"Mux3"
		DstPort			1
	      }
	      Branch {
		Points			[10, 0]
		Branch {
		  DstBlock		  "To Workspace9"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "I_"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "iabs min=(Voc-Vmax)/R"
	      SrcPort		      1
	      Points		      [35, 0]
	      Branch {
		Points			[0, 15; 105, 0; 0, -40]
		DstBlock		"limit current based on \nmax voltage "
"during charge"
		DstPort			3
	      }
	      Branch {
		Points			[0, -30]
		DstBlock		"min charge current\nnot exceeded"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Ibty=(Voc-(Voc^2-4RPbty)^.5)\n       --"
"---------------------------\n(2*R)"
	      SrcPort		      1
	      Points		      [55, 0]
	      Branch {
		Points			[90, 0; 0, 40]
		DstBlock		"limit current based on \nmax voltage "
"during charge"
		DstPort			1
	      }
	      Branch {
		Points			[0, 40]
		DstBlock		"min charge current\nnot exceeded"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Rint"
	      SrcPort		      1
	      Points		      [20, 0]
	      Branch {
		Points			[0, 120]
		Branch {
		  DstBlock		  "Mux5"
		  DstPort		  3
		}
		Branch {
		  Points		  [0, 80]
		  DstBlock		  "Mux3"
		  DstPort		  3
		}
	      }
	      Branch {
		DstBlock		"Mux4"
		DstPort			3
	      }
	    }
	    Line {
	      SrcBlock		      "Voc"
	      SrcPort		      1
	      Points		      [35, 0]
	      Branch {
		Points			[0, 110]
		Branch {
		  DstBlock		  "Mux5"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, 130]
		  DstBlock		  "Mux3"
		  DstPort		  2
		}
	      }
	      Branch {
		DstBlock		"Mux4"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "limited output\npower (W)"
	      SrcPort		      1
	      DstBlock		      "Mux4"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Lookup
	  Name			  "coul eff"
	  Position		  [260, 348, 290, 372]
	  InputValues		  "ess_tmp"
	  OutputValues		  "ess_coulombic_eff"
	}
	Block {
	  BlockType		  Constant
	  Name			  "do ex calcs?"
	  Position		  [420, 220, 480, 235]
	  Orientation		  down
	  ShowName		  off
	  Value			  "ess_th_calc"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "documentation9"
	  Ports			  [0, 0, 0, 0, 0]
	  Position		  [630, 356, 659, 395]
	  BackgroundColor	  orange
	  DropShadow		  on
	  ShowName		  off
	  OpenFcn		  "web(['file:\\\\\\' which('energy_storage.ht"
"m')]);"
	  ShowPortLabels	  off
	  MaskDisplay		  "image(imread('doc_man.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  none
	  MaskIconUnits		  autoscale
	  System {
	    Name		    "documentation9"
	    Location		    [129, 62, 308, 146]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "ess tmp"
	  Ports			  [1, 3, 1, 0, 0]
	  Position		  [405, 248, 495, 302]
	  ShowName		  off
	  ShowPortLabels	  on
	  System {
	    Name		    "ess tmp"
	    Location		    [431, 250, 946, 520]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "Qess_gen"
	      Position		      [25, 205, 45, 225]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [390, 217, 420, 243]
	      StatesWhenEnabling      reset
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "#of mods"
	      Position		      [390, 88, 415, 112]
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/#of mods"
	      Position		      [95, 203, 120, 227]
	      Gain		      "1/ess_module_num"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/mcp"
	      Position		      [380, 153, 405, 177]
	      Gain		      "1/(ess_module_mass*ess_mod_cp)"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [445, 220, 501, 260]
	      BackgroundColor	      green
	      ShowName		      off
	      ShowPortLabels	      on
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      System {
		Name			"Block NOTES"
		Location		[505, 510, 924, 573]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Annotation {
		  Position		  [207, 33]
		  Text			  "This block models the thermal behav"
"ior of a battery module with active air cooling.\nThe module is modeled as a "
"single lumped thermal mass.  \nThe fan is on whenever the battery temp is > t"
"he set temp."
		}
	      }
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [250, 165, 285, 185]
	      Orientation	      left
	      FontName		      "Arial"
	      X0		      "cyc_mph(1,2)*.447"
	      InheritSampleTime	      off
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory1"
	      Position		      [100, 30, 135, 50]
	      Orientation	      left
	      FontName		      "Arial"
	      X0		      "cyc_mph(1,2)*.447"
	      InheritSampleTime	      off
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux20"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [195, 84, 200, 156]
	      NamePlacement	      alternate
	      ShowName		      off
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "Qc"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [350, 114, 360, 221]
	      ShowName		      off
	      Inputs		      "++"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Qess_case"
	      Position		      [235, 108, 315, 132]
	      NamePlacement	      alternate
	      FontName		      "Arial"
	      Expr		      "(u(2) - u(1))/u(3)"
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "Saturation3"
	      Position		      [190, 29, 200, 51]
	      Orientation	      left
	      ShowName		      off
	      UpperLimit	      "1"
	      LowerLimit	      "0"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Tair,ave"
	      Ports		      [1, 2, 1, 0, 0]
	      Position		      [30, 107, 140, 158]
	      ShowPortLabels	      on
	      System {
		Name			"Tair,ave"
		Location		[347, 78, 747, 306]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "Qess_case"
		  Position		  [45, 35, 65, 55]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  [0, 0, 0, 0, 0]
		  Position		  [265, 167, 295, 193]
		  StatesWhenEnabling	  reset
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  [0, 0, 0, 0, 0]
		  Position		  [325, 165, 381, 205]
		  BackgroundColor	  green
		  ShowName		  off
		  ShowPortLabels	  on
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  none
		  MaskIconUnits		  autoscale
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		  }
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Tamb-(Q/mcp)/2"
		  Position		  [90, 34, 330, 56]
		  Expr			  "amb_tmp - (u(1)/(ess_mod_airflow*ai"
"r_cp))/2 "
		}
		Block {
		  BlockType		  Constant
		  Name			  "do ex calcs?1"
		  Position		  [35, 105, 115, 125]
		  ShowName		  off
		  Value			  "ess_th_res_on"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair_ave"
		  Position		  [355, 35, 375, 55]
		  Port			  "1"
		  OutputWhenDisabled	  reset
		  InitialOutput		  "amb_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Th Res"
		  Position		  [355, 105, 375, 125]
		  Port			  "2"
		  OutputWhenDisabled	  reset
		  InitialOutput		  "ess_th_res_off"
		}
		Line {
		  SrcBlock		  "do ex calcs?1"
		  SrcPort		  1
		  DstBlock		  "Th Res"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  DstBlock		  "Tamb-(Q/mcp)/2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tamb-(Q/mcp)/2"
		  SrcPort		  1
		  DstBlock		  "Tair_ave"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Integrator
	      Name		      "Tess2"
	      Ports		      [1, 1, 0, 0, 0]
	      Position		      [420, 155, 440, 175]
	      ExternalReset	      none
	      InitialConditionSource  internal
	      InitialCondition	      "ess_mod_init_tmp"
	      LimitOutput	      off
	      UpperSaturationLimit    "inf"
	      LowerSaturationLimit    "-inf"
	      ShowSaturationPort      off
	      ShowStatePort	      off
	      AbsoluteTolerance	      "auto"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "thermostat"
	      Position		      [235, 29, 340, 51]
	      Orientation	      left
	      NamePlacement	      alternate
	      FontName		      "Arial"
	      Expr		      "u(1) - ess_set_tmp"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Tess"
	      Position		      [470, 155, 490, 175]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Tair"
	      Position		      [470, 60, 490, 80]
	      NamePlacement	      alternate
	      Port		      "2"
	      OutputWhenDisabled      held
	      InitialOutput	      "[]"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Qair"
	      Position		      [470, 90, 490, 110]
	      Port		      "3"
	      OutputWhenDisabled      reset
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Tair,ave"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		Points			[0, -50]
		DstBlock		"Tair"
		DstPort			1
	      }
	      Branch {
		DstBlock		"Mux20"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Tair,ave"
	      SrcPort		      2
	      DstBlock		      "Mux20"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Mux20"
	      SrcPort		      1
	      DstBlock		      "Qess_case"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "#of mods"
	      SrcPort		      1
	      DstBlock		      "Qair"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [-230, 0]
	      DstBlock		      "Tair,ave"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory1"
	      SrcPort		      1
	      Points		      [-10, 0]
	      DstBlock		      "Tair,ave"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Saturation3"
	      SrcPort		      1
	      DstBlock		      "Memory1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "thermostat"
	      SrcPort		      1
	      DstBlock		      "Saturation3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "1/#of mods"
	      SrcPort		      1
	      Points		      [210, 0]
	      DstBlock		      "Qc"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Qess_gen"
	      SrcPort		      1
	      DstBlock		      "1/#of mods"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Tess2"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		Points			[0, -85; -80, 0]
		Branch {
		  Points		  [0, -40]
		  DstBlock		  "thermostat"
		  DstPort		  1
		}
		Branch {
		  Points		  [-185, 0]
		  DstBlock		  "Mux20"
		  DstPort		  1
		}
	      }
	      Branch {
		DstBlock		"Tess"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "1/mcp"
	      SrcPort		      1
	      DstBlock		      "Tess2"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Qess_case"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[0, -20]
		DstBlock		"#of mods"
		DstPort			1
	      }
	      Branch {
		Points			[0, 55]
		DstBlock		"Memory"
		DstPort			1
	      }
	      Branch {
		Points			[10, 0]
		DstBlock		"Qc"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Qc"
	      SrcPort		      1
	      DstBlock		      "1/mcp"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "limit power"
	  Ports			  [4, 1, 0, 0, 0]
	  Position		  [225, 229, 255, 286]
	  ShowPortLabels	  off
	  System {
	    Name		    "limit power"
	    Location		    [30, 141, 1054, 654]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [15, 45, 35, 65]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "Pbty"
	      Position		      [15, 135, 35, 155]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "Voc"
	      Position		      [15, 195, 35, 215]
	      Port		      "3"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "Rint"
	      Position		      [390, 270, 410, 290]
	      Orientation	      left
	      Port		      "4"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant1"
	      Position		      [245, 60, 280, 80]
	      ShowName		      off
	      Value		      "eps"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant2"
	      Position		      [290, 99, 315, 121]
	      ShowName		      off
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant3"
	      Position		      [705, 284, 730, 306]
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant4"
	      Position		      [897, 185, 923, 205]
	      Orientation	      down
	      NamePlacement	      alternate
	      ShowName		      off
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant5"
	      Position		      [650, 36, 685, 54]
	      ShowName		      off
	      Value		      ".999"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant6"
	      Position		      [725, 74, 750, 96]
	      ShowName		      off
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "Gain"
	      Position		      [135, 222, 165, 248]
	      ShowName		      off
	      FontName		      "Arial"
	      Gain		      "0.5"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Limits"
	      Ports		      [8, 0, 0, 0, 0]
	      Position		      [700, 333, 730, 472]
	      FontName		      "Arial"
	      ShowPortLabels	      off
	      System {
		Name			"Limits"
		Location		[405, 387, 971, 978]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "SOC \nhigh limited"
		  Position		  [40, 15, 60, 35]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "not SOC \nlow limited"
		  Position		  [35, 70, 55, 90]
		  Port			  "2"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "power req"
		  Position		  [35, 145, 55, 165]
		  Port			  "3"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "power bat\nlimited"
		  Position		  [35, 220, 55, 240]
		  Port			  "4"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "V used"
		  Position		  [35, 300, 55, 320]
		  Port			  "5"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "V mc_min_volts"
		  Position		  [40, 375, 60, 395]
		  Port			  "6"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "V battery (.5Voc)"
		  Position		  [40, 435, 60, 455]
		  Port			  "7"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "V ess_min_volts"
		  Position		  [40, 510, 60, 530]
		  Port			  "8"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>"
		  Position		  [385, 369, 475, 391]
		  GotoTag		  "ess_pwr_limited"
		  TagVisibility		  global
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>1"
		  Position		  [385, 292, 495, 318]
		  GotoTag		  "mc_voltage_limited"
		  TagVisibility		  global
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>2"
		  Position		  [320, 69, 430, 91]
		  GotoTag		  "ess_soc_low_limited"
		  TagVisibility		  global
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>3"
		  Position		  [385, 458, 490, 482]
		  GotoTag		  "ess_minV_limited"
		  TagVisibility		  global
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>4"
		  Position		  [330, 19, 440, 41]
		  GotoTag		  "ess_soc_hi_limited"
		  TagVisibility		  global
		}
		Block {
		  BlockType		  Logic
		  Name			  "Logical\nOperator1"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [270, 64, 300, 96]
		  Operator		  NOT
		  Inputs		  "1"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator1"
		  Position		  [125, 172, 155, 203]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator3"
		  Position		  [185, 317, 215, 348]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator4"
		  Position		  [190, 402, 220, 433]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator5"
		  Position		  [185, 497, 215, 528]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  Logic
		  Name			  "limited\nby battery"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [330, 362, 360, 393]
		  Operator		  AND
		  Inputs		  "2"
		}
		Block {
		  BlockType		  Logic
		  Name			  "limited\nby battery\nmin V"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [330, 452, 360, 483]
		  Operator		  AND
		  Inputs		  "2"
		}
		Block {
		  BlockType		  Logic
		  Name			  "limited by\nmotor controller"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [335, 287, 365, 318]
		  Operator		  AND
		  Inputs		  "2"
		}
		Line {
		  SrcBlock		  "SOC \nhigh limited"
		  SrcPort		  1
		  Points		  [250, 0]
		  DstBlock		  "Goto <sdo>4"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "not SOC \nlow limited"
		  SrcPort		  1
		  DstBlock		  "Logical\nOperator1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Logical\nOperator1"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "power req"
		  SrcPort		  1
		  Points		  [50, 0]
		  DstBlock		  "Relational\nOperator1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Relational\nOperator5"
		  SrcPort		  1
		  Points		  [95, 0]
		  DstBlock		  "limited\nby battery\nmin V"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Relational\nOperator4"
		  SrcPort		  1
		  Points		  [90, 0]
		  DstBlock		  "limited\nby battery"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Relational\nOperator1"
		  SrcPort		  1
		  Points		  [105, 0; 0, 105]
		  Branch {
		    Points		    [0, 75]
		    Branch {
		    Points		    [0, 90]
		    DstBlock		    "limited\nby battery\nmin V"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "limited\nby battery"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "limited by\nmotor controller"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Relational\nOperator3"
		  SrcPort		  1
		  Points		  [100, 0]
		  DstBlock		  "limited by\nmotor controller"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "limited\nby battery\nmin V"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "limited\nby battery"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "limited by\nmotor controller"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "V ess_min_volts"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator5"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "V battery (.5Voc)"
		  SrcPort		  1
		  Points		  [110, 0]
		  DstBlock		  "Relational\nOperator4"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "V used"
		  SrcPort		  1
		  Points		  [70, 0; 0, 15]
		  Branch {
		    Points		    [0, 85]
		    Branch {
		    Points		    [0, 95]
		    DstBlock		    "Relational\nOperator5"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "Relational\nOperator4"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "V mc_min_volts"
		  SrcPort		  1
		  Points		  [105, 0]
		  DstBlock		  "Relational\nOperator3"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "power bat\nlimited"
		  SrcPort		  1
		  Points		  [50, 0]
		  DstBlock		  "Relational\nOperator1"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Logic
	      Name		      "Logical\nOperator"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [465, 57, 495, 88]
	      ShowName		      off
	      Operator		      OR
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Logic
	      Name		      "Logical\nOperator1"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [830, 32, 860, 63]
	      ShowName		      off
	      Operator		      AND
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [390, 198, 410, 232]
	      FontName		      "Arial"
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [330, 47, 360, 78]
	      ShowName		      off
	      Operator		      ">"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator3"
	      Position		      [405, 87, 435, 118]
	      NamePlacement	      alternate
	      ShowName		      off
	      Operator		      "<"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "SOC>=.999"
	      Position		      [715, 22, 745, 53]
	      Operator		      ">="
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "charging\n(Preq is neg)"
	      Position		      [770, 62, 800, 93]
	      Operator		      "<"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "discharge\nmax power allowed\n(-0.1 is "
"for safety, to prevent\ntaking the square of a tiny\n-ive # in I=I(P) elsewhe"
"re)"
	      Position		      [425, 201, 555, 229]
	      FontName		      "Arial"
	      Expr		      "(u[1]-u[2])*u[2]/u[3]-0.1"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess minimum voltage"
	      Position		      [25, 335, 115, 355]
	      FontName		      "Arial"
	      Value		      "ess_min_volts"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "ess_module_num"
	      Position		      [135, 330, 200, 360]
	      FontName		      "Arial"
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      MinMax
	      Name		      "limit by battery max\nor min mc voltage"
"\nor ess min"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [255, 220, 285, 320]
	      Function		      max
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "mc minimum\nvoltage"
	      Position		      [15, 257, 85, 283]
	      FontName		      "Arial"
	      Value		      "mc_min_volts"
	    }
	    Block {
	      BlockType		      MinMax
	      Name		      "min"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [620, 162, 635, 333]
	      Function		      min
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "no power req if\nSOC<0 and trying \nto "
"discharge"
	      Position		      [770, 245, 800, 275]
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "no power req if\nSOC>.999 and trying \n"
"to charge"
	      Position		      [925, 235, 955, 265]
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Pbty, limited"
	      Position		      [1020, 240, 1040, 260]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Logical\nOperator1"
	      SrcPort		      1
	      Points		      [15, 0; 0, 185]
	      Branch {
		Points			[-195, 0]
		DstBlock		"Limits"
		DstPort			1
	      }
	      Branch {
		Points			[0, 15]
		DstBlock		"no power req if\nSOC>.999 and trying "
"\nto charge"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "no power req if\nSOC>.999 and trying \n"
"to charge"
	      SrcPort		      1
	      DstBlock		      "Pbty, limited"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "no power req if\nSOC<0 and trying \nto "
"discharge"
	      SrcPort		      1
	      DstBlock		      "no power req if\nSOC>.999 and trying \n"
"to charge"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Constant4"
	      SrcPort		      1
	      DstBlock		      "no power req if\nSOC>.999 and trying \n"
"to charge"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Constant5"
	      SrcPort		      1
	      DstBlock		      "SOC>=.999"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "charging\n(Preq is neg)"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "Logical\nOperator1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Constant6"
	      SrcPort		      1
	      DstBlock		      "charging\n(Preq is neg)"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "SOC>=.999"
	      SrcPort		      1
	      DstBlock		      "Logical\nOperator1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      Points		      [190, 0]
	      Branch {
		Points			[0, -25]
		DstBlock		"SOC>=.999"
		DstPort			1
	      }
	      Branch {
		DstBlock		"Relational\nOperator"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "ess_module_num"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[0, 110]
		DstBlock		"Limits"
		DstPort			8
	      }
	      Branch {
		Points			[0, -40]
		DstBlock		"limit by battery max\nor min mc volta"
"ge\nor ess min"
		DstPort			3
	      }
	    }
	    Line {
	      SrcBlock		      "ess minimum voltage"
	      SrcPort		      1
	      DstBlock		      "ess_module_num"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Gain"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		Points			[0, -25; 195, 0; 0, 230]
		DstBlock		"Limits"
		DstPort			7
	      }
	      Branch {
		DstBlock		"limit by battery max\nor min mc volta"
"ge\nor ess min"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Rint"
	      SrcPort		      1
	      Points		      [-15, 0; 0, -55]
	      DstBlock		      "Mux"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "mc minimum\nvoltage"
	      SrcPort		      1
	      Points		      [30, 0]
	      Branch {
		Points			[0, 155]
		DstBlock		"Limits"
		DstPort			6
	      }
	      Branch {
		DstBlock		"limit by battery max\nor min mc volta"
"ge\nor ess min"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "discharge\nmax power allowed\n(-0.1 is "
"for safety, to prevent\ntaking the square of a tiny\n-ive # in I=I(P) elsewhe"
"re)"
	      SrcPort		      1
	      Points		      [5, 0; 0, 75]
	      Branch {
		DstBlock		"min"
		DstPort			2
	      }
	      Branch {
		Points			[0, 105]
		DstBlock		"Limits"
		DstPort			4
	      }
	    }
	    Line {
	      SrcBlock		      "limit by battery max\nor min mc voltage"
"\nor ess min"
	      SrcPort		      1
	      Points		      [65, 0]
	      Branch {
		Points			[0, 140]
		DstBlock		"Limits"
		DstPort			5
	      }
	      Branch {
		Points			[0, -55]
		DstBlock		"Mux"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      DstBlock		      "discharge\nmax power allowed\n(-0.1 is "
"for safety, to prevent\ntaking the square of a tiny\n-ive # in I=I(P) elsewhe"
"re)"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "min"
	      SrcPort		      1
	      Points		      [30, 0]
	      Branch {
		Points			[0, 130]
		DstBlock		"Limits"
		DstPort			3
	      }
	      Branch {
		DstBlock		"no power req if\nSOC<0 and trying \nt"
"o discharge"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Voc"
	      SrcPort		      1
	      Points		      [80, 0]
	      Branch {
		DstBlock		"Gain"
		DstPort			1
	      }
	      Branch {
		DstBlock		"Mux"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Logical\nOperator"
	      SrcPort		      1
	      Points		      [180, 0; 0, 185]
	      Branch {
		Points			[0, 105]
		DstBlock		"Limits"
		DstPort			2
	      }
	      Branch {
		DstBlock		"no power req if\nSOC<0 and trying \nt"
"o discharge"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Constant3"
	      SrcPort		      1
	      Points		      [0, -25]
	      DstBlock		      "no power req if\nSOC<0 and trying \nto "
"discharge"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator3"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "Logical\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Constant2"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator3"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Pbty"
	      SrcPort		      1
	      Points		      [335, 0]
	      Branch {
		Points			[230, 0]
		Branch {
		  Points		  [0, -75]
		  DstBlock		  "charging\n(Preq is neg)"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "min"
		  DstPort		  1
		}
	      }
	      Branch {
		Points			[0, -50]
		DstBlock		"Relational\nOperator3"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      DstBlock		      "Logical\nOperator"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Constant1"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "max pack\npwr (W)1"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [240, 16, 270, 49]
	  ShowPortLabels	  off
	  System {
	    Name		    "max pack\npwr (W)1"
	    Location		    [155, 587, 977, 938]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [50, 25, 70, 45]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "ess_mod_tmp"
	      Position		      [45, 110, 65, 130]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "#bty"
	      Position		      [195, 173, 285, 197]
	      Orientation	      left
	      Value		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant"
	      Position		      [282, 200, 368, 220]
	      Orientation	      up
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "mc_min_volts"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant1"
	      Position		      [335, 90, 370, 110]
	      Orientation	      left
	      Value		      "0.001"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant2"
	      Position		      [645, 190, 680, 210]
	      Orientation	      left
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Constant7"
	      Position		      [435, 60, 475, 80]
	      ShowName		      off
	      Value		      "ess_on"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "Gain"
	      Position		      [320, 142, 350, 168]
	      ShowName		      off
	      FontName		      "Arial"
	      Gain		      "0.5"
	    }
	    Block {
	      BlockType		      MinMax
	      Name		      "MinMax1"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [385, 149, 415, 181]
	      ShowName		      off
	      Function		      max
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [475, 123, 495, 157]
	      FontName		      "Arial"
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Product"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [225, 118, 255, 142]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Product1"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [225, 223, 255, 247]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Rdis\n(ohms)"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [140, 228, 170, 252]
	      ShowPortLabels	      off
	      MaskType		      "2-D Table Lookup"
	      MaskDescription	      "Two Dimensional Table Lookup\nThe first"
" input corresponds to X Index and the second input corresponds to the Y Index"
	      MaskHelp		      "This block returns a linearly interpola"
"ted intersection from the table using the X index (which corresponds to the r"
"ows of the table) and the Y index (which corresponds to the columns of the ta"
"ble).  Extrapolation is used."
	      MaskPromptString	      "X Index|Y Index|Table"
	      MaskStyleString	      "edit,edit,edit"
	      MaskTunableValueString  "on,on,on"
	      MaskInitialization      "xindex=@1; yindex=@2; table=@3; sftab2c"
"hk(xindex,yindex,table);"
	      MaskDisplay	      "plot(-10,-10,110,110,[90,50,10],[90,40,"
"30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      MaskValueString	      "ess_tmp|ess_soc|ess_r_dis"
	      System {
		Name			"Rdis\n(ohms)"
		Location		[316, 263, 598, 417]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "x0"
		  Position		  [20, 25, 40, 45]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "y0"
		  Position		  [20, 80, 40, 100]
		  Port			  "2"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [90, 46, 120, 79]
		  Inputs		  "2"
		}
		Block {
		  BlockType		  "S-Function"
		  Name			  "S-function"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [140, 52, 190, 78]
		  FunctionName		  "sftable2"
		  Parameters		  "xindex, yindex, table"
		  PortCounts		  "[]"
		  SFunctionModules	  "''"
		}
		Block {
		  BlockType		  Outport
		  Name			  "table out"
		  Position		  [215, 55, 235, 75]
		  Port			  "1"
		  OutputWhenDisabled	  held
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "y0"
		  SrcPort		  1
		  Points		  [20, 0; 0, -20]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "S-function"
		  SrcPort		  1
		  DstBlock		  "table out"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "x0"
		  SrcPort		  1
		  Points		  [20, 0; 0, 20]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "S-function"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [340, 27, 370, 58]
	      Operator		      ">"
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Switch"
	      Position		      [645, 140, 675, 170]
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "VOC\n(V)"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [145, 113, 175, 137]
	      ShowPortLabels	      off
	      MaskType		      "2-D Table Lookup"
	      MaskDescription	      "Two Dimensional Table Lookup\nThe first"
" input corresponds to X Index and the second input corresponds to the Y Index"
	      MaskHelp		      "This block returns a linearly interpola"
"ted intersection from the table using the X index (which corresponds to the r"
"ows of the table) and the Y index (which corresponds to the columns of the ta"
"ble).  Extrapolation is used."
	      MaskPromptString	      "X Index|Y Index|Table"
	      MaskStyleString	      "edit,edit,edit"
	      MaskTunableValueString  "on,on,on"
	      MaskInitialization      "xindex=@1; yindex=@2; table=@3; sftab2c"
"hk(xindex,yindex,table);"
	      MaskDisplay	      "plot(-10,-10,110,110,[90,50,10],[90,40,"
"30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      MaskValueString	      "ess_tmp|ess_soc|ess_voc"
	      System {
		Name			"VOC\n(V)"
		Location		[316, 263, 598, 417]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "x0"
		  Position		  [20, 25, 40, 45]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "y0"
		  Position		  [20, 80, 40, 100]
		  Port			  "2"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [90, 46, 120, 79]
		  Inputs		  "2"
		}
		Block {
		  BlockType		  "S-Function"
		  Name			  "S-function"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [140, 52, 190, 78]
		  FunctionName		  "sftable2"
		  Parameters		  "xindex, yindex, table"
		  PortCounts		  "[]"
		  SFunctionModules	  "''"
		}
		Block {
		  BlockType		  Outport
		  Name			  "table out"
		  Position		  [215, 55, 235, 75]
		  Port			  "1"
		  OutputWhenDisabled	  held
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "y0"
		  SrcPort		  1
		  Points		  [20, 0; 0, -20]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "S-function"
		  SrcPort		  1
		  DstBlock		  "table out"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "x0"
		  SrcPort		  1
		  Points		  [20, 0; 0, 20]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "S-function"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Logic
	      Name		      "and"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [505, 37, 535, 68]
	      NamePlacement	      alternate
	      ShowName		      off
	      Operator		      AND
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "max power corresponding\nto minimum vol"
"tage"
	      Position		      [520, 131, 615, 159]
	      FontName		      "Arial"
	      Expr		      "(u[1]-u[2])*u[2]/u[3]"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "min ess V"
	      Position		      [195, 277, 360, 303]
	      Value		      "ess_module_num*ess_min_volts"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "max ess\ndischarge\npwr"
	      Position		      [730, 145, 750, 165]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Switch"
	      SrcPort		      1
	      DstBlock		      "max ess\ndischarge\npwr"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      Points		      [45, 0]
	      Branch {
		Points			[0, 95]
		Branch {
		  DstBlock		  "VOC\n(V)"
		  DstPort		  2
		}
		Branch {
		  Points		  [0, 115]
		  DstBlock		  "Rdis\n(ohms)"
		  DstPort		  2
		}
	      }
	      Branch {
		DstBlock		"Relational\nOperator"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Constant2"
	      SrcPort		      1
	      Points		      [-10, 0]
	      DstBlock		      "Switch"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "max power corresponding\nto minimum vol"
"tage"
	      SrcPort		      1
	      DstBlock		      "Switch"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "#bty"
	      SrcPort		      1
	      Points		      [-10, 0]
	      Branch {
		Points			[0, 45]
		DstBlock		"Product1"
		DstPort			1
	      }
	      Branch {
		Points			[0, -50]
		DstBlock		"Product"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Rdis\n(ohms)"
	      SrcPort		      1
	      DstBlock		      "Product1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "VOC\n(V)"
	      SrcPort		      1
	      DstBlock		      "Product"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Product1"
	      SrcPort		      1
	      Points		      [200, 0]
	      DstBlock		      "Mux"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Product"
	      SrcPort		      1
	      Points		      [0, 5; 40, 0]
	      Branch {
		Points			[0, 20]
		DstBlock		"Gain"
		DstPort			1
	      }
	      Branch {
		Points			[160, 0]
		DstBlock		"Mux"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "MinMax1"
	      SrcPort		      1
	      Points		      [0, -25]
	      DstBlock		      "Mux"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Gain"
	      SrcPort		      1
	      DstBlock		      "MinMax1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      Points		      [0, 5]
	      DstBlock		      "max power corresponding\nto minimum vol"
"tage"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Constant"
	      SrcPort		      1
	      Points		      [25, 0; 0, -30]
	      DstBlock		      "MinMax1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Constant1"
	      SrcPort		      1
	      Points		      [-5, 0]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "ess_mod_tmp"
	      SrcPort		      1
	      Points		      [40, 0]
	      Branch {
		DstBlock		"VOC\n(V)"
		DstPort			1
	      }
	      Branch {
		Points			[0, 115]
		DstBlock		"Rdis\n(ohms)"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "min ess V"
	      SrcPort		      1
	      Points		      [5, 0]
	      DstBlock		      "MinMax1"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "and"
	      SrcPort		      1
	      Points		      [90, 0]
	      DstBlock		      "Switch"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      DstBlock		      "and"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Constant7"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "and"
	      DstPort		      2
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "pack\nVoc, Rint"
	  Ports			  [3, 2, 0, 0, 0]
	  Position		  [135, 132, 165, 188]
	  ShowPortLabels	  off
	  System {
	    Name		    "pack\nVoc, Rint"
	    Location		    [123, 344, 671, 647]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC (prev)"
	      Position		      [25, 80, 45, 100]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "req'd battery\npower (W)"
	      Position		      [230, 160, 250, 180]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "mod tmp \n (C)"
	      Position		      [80, 140, 100, 160]
	      Port		      "3"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "#bty"
	      Position		      [255, 64, 350, 86]
	      Value		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Product"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [380, 28, 410, 52]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Product1"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [380, 103, 410, 127]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Rchg\n(ohms)"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [200, 228, 230, 252]
	      ShowPortLabels	      off
	      MaskType		      "2-D Table Lookup"
	      MaskDescription	      "Two Dimensional Table Lookup\nThe first"
" input corresponds to X Index and the second input corresponds to the Y Index"
	      MaskHelp		      "This block returns a linearly interpola"
"ted intersection from the table using the X index (which corresponds to the r"
"ows of the table) and the Y index (which corresponds to the columns of the ta"
"ble).  Extrapolation is used."
	      MaskPromptString	      "X Index|Y Index|Table"
	      MaskStyleString	      "edit,edit,edit"
	      MaskTunableValueString  "on,on,on"
	      MaskInitialization      "xindex=@1; yindex=@2; table=@3; sftab2c"
"hk(xindex,yindex,table);"
	      MaskDisplay	      "plot(-10,-10,110,110,[90,50,10],[90,40,"
"30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      MaskValueString	      "ess_tmp|ess_soc|ess_r_chg"
	      System {
		Name			"Rchg\n(ohms)"
		Location		[316, 263, 598, 417]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "x0"
		  Position		  [20, 25, 40, 45]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "y0"
		  Position		  [20, 80, 40, 100]
		  Port			  "2"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [90, 46, 120, 79]
		  Inputs		  "2"
		}
		Block {
		  BlockType		  "S-Function"
		  Name			  "S-function"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [140, 52, 190, 78]
		  FunctionName		  "sftable2"
		  Parameters		  "xindex, yindex, table"
		  PortCounts		  "[]"
		  SFunctionModules	  "''"
		}
		Block {
		  BlockType		  Outport
		  Name			  "table out"
		  Position		  [215, 55, 235, 75]
		  Port			  "1"
		  OutputWhenDisabled	  held
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "S-function"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "x0"
		  SrcPort		  1
		  Points		  [20, 0; 0, 20]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "S-function"
		  SrcPort		  1
		  DstBlock		  "table out"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "y0"
		  SrcPort		  1
		  Points		  [20, 0; 0, -20]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Rdis\n(ohms)"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [195, 108, 225, 132]
	      ShowPortLabels	      off
	      MaskType		      "2-D Table Lookup"
	      MaskDescription	      "Two Dimensional Table Lookup\nThe first"
" input corresponds to X Index and the second input corresponds to the Y Index"
	      MaskHelp		      "This block returns a linearly interpola"
"ted intersection from the table using the X index (which corresponds to the r"
"ows of the table) and the Y index (which corresponds to the columns of the ta"
"ble).  Extrapolation is used."
	      MaskPromptString	      "X Index|Y Index|Table"
	      MaskStyleString	      "edit,edit,edit"
	      MaskTunableValueString  "on,on,on"
	      MaskInitialization      "xindex=@1; yindex=@2; table=@3; sftab2c"
"hk(xindex,yindex,table);"
	      MaskDisplay	      "plot(-10,-10,110,110,[90,50,10],[90,40,"
"30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      MaskValueString	      "ess_tmp|ess_soc|ess_r_dis"
	      System {
		Name			"Rdis\n(ohms)"
		Location		[316, 263, 598, 417]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "x0"
		  Position		  [20, 25, 40, 45]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "y0"
		  Position		  [20, 80, 40, 100]
		  Port			  "2"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [90, 46, 120, 79]
		  Inputs		  "2"
		}
		Block {
		  BlockType		  "S-Function"
		  Name			  "S-function"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [140, 52, 190, 78]
		  FunctionName		  "sftable2"
		  Parameters		  "xindex, yindex, table"
		  PortCounts		  "[]"
		  SFunctionModules	  "''"
		}
		Block {
		  BlockType		  Outport
		  Name			  "table out"
		  Position		  [215, 55, 235, 75]
		  Port			  "1"
		  OutputWhenDisabled	  held
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "S-function"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "x0"
		  SrcPort		  1
		  Points		  [20, 0; 0, 20]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "S-function"
		  SrcPort		  1
		  DstBlock		  "table out"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "y0"
		  SrcPort		  1
		  Points		  [20, 0; 0, -20]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Switch"
	      Position		      [305, 154, 335, 186]
	      Threshold		      "0"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "VOC\n(V)"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [205, 23, 235, 47]
	      ShowPortLabels	      off
	      MaskType		      "2-D Table Lookup"
	      MaskDescription	      "Two Dimensional Table Lookup\nThe first"
" input corresponds to X Index and the second input corresponds to the Y Index"
	      MaskHelp		      "This block returns a linearly interpola"
"ted intersection from the table using the X index (which corresponds to the r"
"ows of the table) and the Y index (which corresponds to the columns of the ta"
"ble).  Extrapolation is used."
	      MaskPromptString	      "X Index|Y Index|Table"
	      MaskStyleString	      "edit,edit,edit"
	      MaskTunableValueString  "on,on,on"
	      MaskInitialization      "xindex=@1; yindex=@2; table=@3; sftab2c"
"hk(xindex,yindex,table);"
	      MaskDisplay	      "plot(-10,-10,110,110,[90,50,10],[90,40,"
"30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      MaskValueString	      "ess_tmp|ess_soc|ess_voc"
	      System {
		Name			"VOC\n(V)"
		Location		[316, 263, 598, 417]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "x0"
		  Position		  [20, 25, 40, 45]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Inport
		  Name			  "y0"
		  Position		  [20, 80, 40, 100]
		  Port			  "2"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [2, 1, 0, 0, 0]
		  Position		  [90, 46, 120, 79]
		  Inputs		  "2"
		}
		Block {
		  BlockType		  "S-Function"
		  Name			  "S-function"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [140, 52, 190, 78]
		  FunctionName		  "sftable2"
		  Parameters		  "xindex, yindex, table"
		  PortCounts		  "[]"
		  SFunctionModules	  "''"
		}
		Block {
		  BlockType		  Outport
		  Name			  "table out"
		  Position		  [215, 55, 235, 75]
		  Port			  "1"
		  OutputWhenDisabled	  held
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "S-function"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "x0"
		  SrcPort		  1
		  Points		  [20, 0; 0, 20]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "S-function"
		  SrcPort		  1
		  DstBlock		  "table out"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "y0"
		  SrcPort		  1
		  Points		  [20, 0; 0, -20]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "pack open-\ncircuit voltage"
	      Position		      [450, 30, 470, 50]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "pack\nresistance"
	      Position		      [450, 105, 470, 125]
	      Port		      "2"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "mod tmp \n (C)"
	      SrcPort		      1
	      Points		      [55, 0]
	      Branch {
		Points			[0, 85]
		DstBlock		"Rchg\n(ohms)"
		DstPort			1
	      }
	      Branch {
		Points			[0, -35]
		Branch {
		  DstBlock		  "Rdis\n(ohms)"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, -85]
		  DstBlock		  "VOC\n(V)"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "SOC (prev)"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		Points			[0, 35]
		Branch {
		  Points		  [0, 120]
		  DstBlock		  "Rchg\n(ohms)"
		  DstPort		  2
		}
		Branch {
		  DstBlock		  "Rdis\n(ohms)"
		  DstPort		  2
		}
	      }
	      Branch {
		Points			[0, -50]
		DstBlock		"VOC\n(V)"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Switch"
	      SrcPort		      1
	      Points		      [25, 0]
	      DstBlock		      "Product1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "req'd battery\npower (W)"
	      SrcPort		      1
	      DstBlock		      "Switch"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Rdis\n(ohms)"
	      SrcPort		      1
	      Points		      [30, 0; 0, 40]
	      DstBlock		      "Switch"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Rchg\n(ohms)"
	      SrcPort		      1
	      Points		      [45, 0; 0, -60]
	      DstBlock		      "Switch"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "VOC\n(V)"
	      SrcPort		      1
	      DstBlock		      "Product"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "#bty"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[0, -30]
		DstBlock		"Product"
		DstPort			2
	      }
	      Branch {
		Points			[0, 35]
		DstBlock		"Product1"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Product1"
	      SrcPort		      1
	      DstBlock		      "pack\nresistance"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Product"
	      SrcPort		      1
	      DstBlock		      "pack open-\ncircuit voltage"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "stop sim"
	  Ports			  [1, 0, 1, 0, 0]
	  Position		  [525, 94, 585, 126]
	  ShowPortLabels	  on
	  System {
	    Name		    "stop sim"
	    Location		    [423, 258, 819, 468]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [75, 85, 95, 105]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [170, 25, 190, 45]
	      StatesWhenEnabling      held
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [95, 145, 165, 165]
	      Orientation	      up
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      ".001"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [185, 88, 215, 112]
	      Operator		      "<"
	    }
	    Block {
	      BlockType		      Stop
	      Name		      "Stop Simulation"
	      Position		      [255, 83, 295, 117]
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      DstBlock		      "Stop Simulation"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      Points		      [0, -35]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	  }
	}
	Block {
	  BlockType		  Outport
	  Name			  "power available\nto bus (W)"
	  Position		  [440, 160, 460, 180]
	  FontName		  "Arial"
	  Port			  "1"
	  OutputWhenDisabled	  held
	  InitialOutput		  "0"
	}
	Line {
	  SrcBlock		  "Memory"
	  SrcPort		  1
	  Points		  [10, 0]
	  Branch {
	    Points		    [0, 80; -230, 0]
	    Branch {
	      Points		      [-70, 0]
	      Branch {
		Points			[-40, 0]
		Branch {
		  Points		  [0, -295]
		  DstBlock		  "max pack\npwr (W)1"
		  DstPort		  2
		}
		Branch {
		  Points		  [-85, 0]
		  DstBlock		  "pack\nVoc, Rint"
		  DstPort		  3
		}
	      }
	      Branch {
		DstBlock		"coul eff"
		DstPort			1
	      }
	    }
	    Branch {
	      DstBlock		      "SOC\nalgorithm"
	      DstPort		      2
	    }
	  }
	  Branch {
	    DstBlock		    "To WS2"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "max pack\npwr (W)1"
	  SrcPort		  1
	  DstBlock		  "Goto <cs>1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "coul eff"
	  SrcPort		  1
	  Points		  [0, -70]
	  DstBlock		  "Mux"
	  DstPort		  4
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  1
	  DstBlock		  "Memory"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  3
	  DstBlock		  "To WS4"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  2
	  DstBlock		  "To WS3"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "limit power"
	  SrcPort		  1
	  Points		  [5, 0; 0, -35; -50, 0]
	  DstBlock		  "compute\ncurrent"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "pack\nVoc, Rint"
	  SrcPort		  1
	  Points		  [15, 0]
	  Branch {
	    Points		    [0, 120]
	    DstBlock		    "limit power"
	    DstPort		    3
	  }
	  Branch {
	    Points		    [30, 0]
	    DstBlock		    "compute\ncurrent"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "pack\nVoc, Rint"
	  SrcPort		  2
	  Points		  [10, -10]
	  Branch {
	    Points		    [0, 115]
	    Branch {
	      Points		      [0, 30; 110, 0]
	      DstBlock		      "Mux"
	      DstPort		      2
	    }
	    Branch {
	      DstBlock		      "limit power"
	      DstPort		      4
	    }
	  }
	  Branch {
	    Points		    [35, 0]
	    DstBlock		    "compute\ncurrent"
	    DstPort		    2
	  }
	}
	Line {
	  SrcBlock		  "Const"
	  SrcPort		  1
	  DstBlock		  "stop sim"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "SOC\nalgorithm"
	  SrcPort		  1
	  Points		  [0, -5; 15, 0]
	  Branch {
	    Points		    [0, -25; -170, 0]
	    Branch {
	      Points		      [0, -60]
	      DstBlock		      "max pack\npwr (W)1"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [-95, 0; 0, 25]
	      Branch {
		Points			[0, 15]
		Branch {
		  Points		  [80, 0; 0, 65; 30, 0]
		}
		Branch {
		  Points		  [0, 15]
		  Branch {
		    Points		    [0, 95]
		    DstBlock		    "limit power"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "pack\nVoc, Rint"
		    DstPort		    1
		  }
		}
	      }
	      Branch {
		Points			[20, 0]
		DstBlock		"Goto <sdo>, <cs>"
		DstPort			1
	      }
	    }
	  }
	  Branch {
	    DstBlock		    "stop sim"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "do ex calcs?"
	  SrcPort		  1
	  DstBlock		  "ess tmp"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "Fcn"
	  SrcPort		  1
	  Points		  [5, 0]
	  Branch {
	    DstBlock		    "ess tmp"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "To WS1"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "Product"
	  SrcPort		  1
	  Points		  [35, 0]
	  Branch {
	    DstBlock		    "power available\nto bus (W)"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "To Workspace9"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "compute\ncurrent"
	  SrcPort		  1
	  Points		  [0, -10; 25, 0]
	  Branch {
	    Points		    [0, 20]
	    Branch {
	      DstBlock		      "Mux"
	      DstPort		      1
	    }
	    Branch {
	      DstBlock		      "Product"
	      DstPort		      1
	    }
	  }
	  Branch {
	    Points		    [0, -40]
	    DstBlock		    "SOC\nalgorithm"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "power req'd\ninto bus (W)"
	  SrcPort		  1
	  Points		  [25, 0]
	  Branch {
	    DstBlock		    "pack\nVoc, Rint"
	    DstPort		    2
	  }
	  Branch {
	    Points		    [0, 90; 30, 0]
	    Branch {
	      DstBlock		      "limit power"
	      DstPort		      2
	    }
	    Branch {
	      Points		      [0, 15]
	      DstBlock		      "To Workspace8"
	      DstPort		      1
	    }
	  }
	}
	Line {
	  SrcBlock		  "Mux"
	  SrcPort		  1
	  DstBlock		  "Fcn"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "compute\ncurrent"
	  SrcPort		  2
	  Points		  [0, -10; 15, 0]
	  Branch {
	    Points		    [0, 35]
	    Branch {
	      DstBlock		      "Goto <mc>, <gc>, <sdo>"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [0, 70]
	      DstBlock		      "Mux"
	      DstPort		      3
	    }
	  }
	  Branch {
	    DstBlock		    "Product"
	    DstPort		    2
	  }
	}
      }
    }
    Block {
      BlockType		      SubSystem
      Name		      "energy\nstorage <ess>\nnnet"
      Ports		      [1, 1, 0, 0, 0]
      Position		      [120, 224, 160, 306]
      ShowPortLabels	      off
      System {
	Name			"energy\nstorage <ess>\nnnet"
	Location		[65, 195, 1093, 802]
	Open			off
	ToolBar			off
	StatusBar		off
	ScreenColor		white
	PaperOrientation	landscape
	PaperPositionMode	auto
	PaperType		usletter
	PaperUnits		inches
	Block {
	  BlockType		  Inport
	  Name			  "power req'd\ninto bus (W)"
	  Position		  [110, 250, 130, 270]
	  FontName		  "Arial"
	  Port			  "1"
	  PortWidth		  "-1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  Gain
	  Name			  "# batteries1"
	  Position		  [650, 266, 695, 294]
	  NamePlacement		  alternate
	  Gain			  "ess_module_num"
	}
	Block {
	  BlockType		  Gain
	  Name			  "# batteries2"
	  Position		  [610, 205, 660, 235]
	  Gain			  "ess_module_num"
	}
	Block {
	  BlockType		  Gain
	  Name			  "1/# batteries"
	  Position		  [200, 240, 345, 280]
	  Gain			  "1/ess_module_num"
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const"
	  Position		  [210, 345, 280, 365]
	  Orientation		  down
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "enable_stop"
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const2"
	  Position		  [575, 420, 630, 440]
	  Orientation		  left
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "amb_tmp"
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const4"
	  Position		  [285, 103, 305, 127]
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "0"
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const5"
	  Position		  [405, 353, 425, 377]
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "0"
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const6"
	  Position		  [450, 278, 470, 302]
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "0"
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <cs>1"
	  Position		  [415, 510, 495, 530]
	  GotoTag		  "ess_max_pwr"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <mc>, <gc>, <sdo>"
	  Position		  [700, 210, 780, 230]
	  GotoTag		  "bus_voltage"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <sdo>, <cs>"
	  Position		  [365, 449, 410, 471]
	  GotoTag		  "SOC"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "Limits"
	  Ports			  [2, 0, 0, 0, 0]
	  Position		  [935, 15, 965, 95]
	  FontName		  "Arial"
	  ShowPortLabels	  off
	  System {
	    Name		    "Limits"
	    Location		    [74, 112, 640, 703]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "power req"
	      Position		      [60, 315, 80, 335]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "power \navailable from\nbattery"
	      Position		      [60, 390, 80, 410]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const1"
	      Position		      [265, 35, 285, 55]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const2"
	      Position		      [270, 90, 290, 110]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const3"
	      Position		      [275, 150, 295, 170]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const4"
	      Position		      [285, 205, 305, 225]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>"
	      Position		      [395, 349, 485, 371]
	      GotoTag		      "ess_pwr_limited"
	      TagVisibility	      global
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>1"
	      Position		      [340, 202, 450, 228]
	      GotoTag		      "mc_voltage_limited"
	      TagVisibility	      global
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>2"
	      Position		      [310, 34, 400, 56]
	      GotoTag		      "ess_soc_limited"
	      TagVisibility	      global
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>3"
	      Position		      [330, 148, 435, 172]
	      GotoTag		      "ess_minV_limited"
	      TagVisibility	      global
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>4"
	      Position		      [320, 88, 425, 112]
	      GotoTag		      "ess_maxV_limited"
	      TagVisibility	      global
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator1"
	      Position		      [150, 342, 180, 373]
	      ShowName		      off
	      Operator		      "=="
	    }
	    Block {
	      BlockType		      Logic
	      Name		      "limited\nby battery"
	      Ports		      [1, 1, 0, 0, 0]
	      Position		      [330, 344, 360, 376]
	      Operator		      NOT
	      Inputs		      "1"
	    }
	    Line {
	      SrcBlock		      "Const1"
	      SrcPort		      1
	      DstBlock		      "Goto <sdo>2"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const2"
	      SrcPort		      1
	      DstBlock		      "Goto <sdo>4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const3"
	      SrcPort		      1
	      DstBlock		      "Goto <sdo>3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const4"
	      SrcPort		      1
	      DstBlock		      "Goto <sdo>1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "power \navailable from\nbattery"
	      SrcPort		      1
	      Points		      [50, 0]
	      DstBlock		      "Relational\nOperator1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "power req"
	      SrcPort		      1
	      Points		      [50, 0]
	      DstBlock		      "Relational\nOperator1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "limited\nby battery"
	      SrcPort		      1
	      DstBlock		      "Goto <sdo>"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator1"
	      SrcPort		      1
	      DstBlock		      "limited\nby battery"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Logic
	  Name			  "Logical\nOperator"
	  Ports			  [1, 1, 0, 0, 0]
	  Position		  [370, 170, 400, 200]
	  Orientation		  down
	  NamePlacement		  alternate
	  ShowName		  off
	  Operator		  NOT
	  Inputs		  "1"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "NNet"
	  Ports			  [2, 2, 1, 0, 0]
	  Position		  [360, 240, 415, 320]
	  ShowPortLabels	  on
	  System {
	    Name		    "NNet"
	    Location		    [481, 588, 979, 888]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "Preq"
	      Position		      [40, 60, 60, 80]
	      FontName		      "Arial"
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [40, 160, 60, 180]
	      FontName		      "Arial"
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [245, 30, 265, 50]
	      StatesWhenEnabling      held
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "De-Normalizer1\nVoltage"
	      Position		      [375, 155, 435, 185]
	      Expr		      "(u-0.2)*(ess_MMo(2,2)-ess_MMo(2,1))/(0."
"8-0.2)+ess_MMo(2,1)"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "De-Normalizer2\nCurrent"
	      Position		      [370, 55, 430, 85]
	      Expr		      "(u-0.2)*(ess_MMo(1,2)-ess_MMo(1,1))/(0."
"8-0.2)+ess_MMo(1,1)"
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux"
	      Ports		      [1, 2, 0, 0, 0]
	      Position		      [305, 107, 340, 143]
	      Outputs		      "2"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [175, 107, 210, 143]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Neural Network"
	      Ports		      [1, 1, 0, 0, 0]
	      Position		      [225, 105, 285, 145]
	      BackgroundColor	      lightBlue
	      ShowPortLabels	      on
	      System {
		Name			"Neural Network"
		Location		[614, 586, 1114, 846]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "p{1}"
		  Position		  [40, 40, 60, 60]
		  BackgroundColor	  magenta
		  Port			  "1"
		  PortWidth		  "2"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  From
		  Name			  " a{1} "
		  Position		  [40, 120, 60, 140]
		  GotoTag		  "feedback1"
		  MaskDisplay		  "plot(cos(0:.1:2*pi),sin(0:.1:2*pi))"
		  MaskIconFrame		  off
		  MaskIconOpaque	  on
		  MaskIconRotate	  none
		  MaskIconUnits		  autoscale
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Layer 1"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [190, 40, 250, 60]
		  BackgroundColor	  lightBlue
		  ShowPortLabels	  on
		  System {
		    Name		    "Layer 1"
		    Location		    [557, 498, 1057, 758]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "p{1}"
		    Position		    [40, 40, 60, 60]
		    BackgroundColor	    magenta
		    Port		    "1"
		    PortWidth		    "2"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Delays 1"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [100, 40, 120, 60]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    MaskDisplay		    "disp('TDL')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    System {
		    Name		    "Delays 1"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "p{1}"
		    Position		    [60, 40, 80, 60]
		    Orientation		    down
		    BackgroundColor	    magenta
		    NamePlacement	    alternate
		    Port		    "1"
		    PortWidth		    "2"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "mux"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [200, 60, 240, 80]
		    BackgroundColor	    lightBlue
		    Inputs		    "1"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "pd{1,1}"
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    magenta
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "p{1}"
		    SrcPort		    1
		    DstBlock		    "mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "mux"
		    SrcPort		    1
		    DstBlock		    "pd{1,1}"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "IW{1,1}"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [160, 40, 200, 60]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    MaskDisplay		    "disp('weight')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    System {
		    Name		    "IW{1,1}"
		    Location		    [74, 196, 574, 456]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "pd{1,1}"
		    Position		    [40, 120, 60, 140]
		    BackgroundColor	    magenta
		    Port		    "1"
		    PortWidth		    "2"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{1,1}(1,:)'"
		    Position		    [140, 40, 180, 60]
		    BackgroundColor	    lightBlue
		    Value		    "[-4.5598890000000001;5.793647]"
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{1,1}(2,:)'"
		    Position		    [140, 100, 180, 120]
		    BackgroundColor	    lightBlue
		    Value		    "[-2.8283469999999999;1.417519]"
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{1,1}(3,:)'"
		    Position		    [140, 160, 180, 180]
		    BackgroundColor	    lightBlue
		    Value		    "[-2.3043559999999998;-1.446742999"
"9999999]"
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [3, 1, 0, 0, 0]
		    Position		    [340, 120, 380, 140]
		    Inputs		    "3"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod1"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 40, 260, 80]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    System {
		    Name		    "dotprod1"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    normalized
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [125, 55, 145, 75]
		    Inputs		    "+"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod2"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 100, 260, 140]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    System {
		    Name		    "dotprod2"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    normalized
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [125, 55, 145, 75]
		    Inputs		    "+"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod3"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 160, 260, 200]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    System {
		    Name		    "dotprod3"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    normalized
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [125, 55, 145, 75]
		    Inputs		    "+"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "iz{1,1}"
		    Position		    [420, 120, 440, 140]
		    BackgroundColor	    magenta
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "IW{1,1}(1,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod1"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "IW{1,1}(2,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "pd{1,1}"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "dotprod1"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "dotprod2"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "dotprod3"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "dotprod2"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "IW{1,1}(3,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod3"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod3"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    3
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "iz{1,1}"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "b{1}"
		    Position		    [160, 80, 200, 100]
		    BackgroundColor	    lightBlue
		    Value		    "[-6.0348629999999996;2.0410720000"
"000002;2.002373]"
		    MaskDisplay		    "disp('bias')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "logsig"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    MaskDisplay		    "plot([-1 1],[0 0],[-1 -.9 -.8 -.7"
" -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1],1./(1+exp(-8*[-1 -.9"
" -.8 -.7 -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1]))+.01)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    System {
		    Name		    "logsig"
		    Location		    [260, 574, 703, 704]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "n"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Exp"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [155, 25, 185, 55]
		    Operator		    exp
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "Gain"
		    Position		    [90, 25, 120, 55]
		    Gain		    "-1"
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Reciprocal"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [295, 35, 325, 65]
		    Operator		    reciprocal
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [225, 32, 255, 63]
		    Inputs		    "++"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "one"
		    Position		    [155, 75, 175, 95]
		    Value		    "1"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a"
		    Position		    [370, 43, 400, 57]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Reciprocal"
		    SrcPort		    1
		    DstBlock		    "a"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "Reciprocal"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "one"
		    SrcPort		    1
		    Points		    [30, 0]
		    DstBlock		    "Sum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Exp"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Gain"
		    SrcPort		    1
		    DstBlock		    "Exp"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "n"
		    SrcPort		    1
		    DstBlock		    "Gain"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "netsum"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 60, 260, 80]
		    BackgroundColor	    lightBlue
		    Inputs		    "2"
		    MaskDisplay		    "disp('+')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a{1}"
		    Position		    [360, 60, 380, 80]
		    BackgroundColor	    magenta
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "[0;0;0]"
		    }
		    Line {
		    SrcBlock		    "p{1}"
		    SrcPort		    1
		    DstBlock		    "Delays 1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Delays 1"
		    SrcPort		    1
		    DstBlock		    "IW{1,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "IW{1,1}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "b{1}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "netsum"
		    SrcPort		    1
		    DstBlock		    "logsig"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "logsig"
		    SrcPort		    1
		    DstBlock		    "a{1}"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Layer 2"
		  Ports			  [1, 1, 0, 0, 0]
		  Position		  [190, 80, 250, 100]
		  BackgroundColor	  lightBlue
		  ShowPortLabels	  on
		  System {
		    Name		    "Layer 2"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "a{1} "
		    Position		    [40, 40, 60, 60]
		    BackgroundColor	    magenta
		    Port		    "1"
		    PortWidth		    "3"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Delays 1"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [100, 40, 120, 60]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    MaskDisplay		    "disp('TDL')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    System {
		    Name		    "Delays 1"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "p{2}"
		    Position		    [60, 40, 80, 60]
		    Orientation		    down
		    BackgroundColor	    magenta
		    NamePlacement	    alternate
		    Port		    "1"
		    PortWidth		    "3"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "mux"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [200, 60, 240, 80]
		    BackgroundColor	    lightBlue
		    Inputs		    "1"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "pd{2,1}"
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    magenta
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "p{2}"
		    SrcPort		    1
		    DstBlock		    "mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "mux"
		    SrcPort		    1
		    DstBlock		    "pd{2,1}"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "LW{2,1}"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [160, 40, 200, 60]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    MaskDisplay		    "disp('weight')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    System {
		    Name		    "LW{2,1}"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "ad{2,1}"
		    Position		    [40, 90, 60, 110]
		    BackgroundColor	    magenta
		    Port		    "1"
		    PortWidth		    "3"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{2,1}(1,:)'"
		    Position		    [140, 40, 180, 60]
		    BackgroundColor	    lightBlue
		    Value		    "[-0.2776092;-2.6799360000000001;-"
"2.2138360000000001]"
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{2,1}(2,:)'"
		    Position		    [140, 100, 180, 120]
		    BackgroundColor	    lightBlue
		    Value		    "[3.601111;2.064257;0.866180799999"
"99997]"
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [340, 90, 380, 110]
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod1"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 40, 260, 80]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    System {
		    Name		    "dotprod1"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    normalized
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [125, 55, 145, 75]
		    Inputs		    "+"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod2"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 100, 260, 140]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    System {
		    Name		    "dotprod2"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    normalized
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [125, 55, 145, 75]
		    Inputs		    "+"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "lz{2,1}"
		    Position		    [420, 90, 440, 110]
		    BackgroundColor	    magenta
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "IW{2,1}(1,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod1"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "IW{2,1}(2,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "ad{2,1}"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "dotprod1"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "dotprod2"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "dotprod2"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "lz{2,1}"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "b{2}"
		    Position		    [160, 80, 200, 100]
		    BackgroundColor	    lightBlue
		    Value		    "[3.0652170000000001;-2.2814760000"
"000001]"
		    MaskDisplay		    "disp('bias')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "logsig"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    lightBlue
		    ShowPortLabels	    on
		    MaskDisplay		    "plot([-1 1],[0 0],[-1 -.9 -.8 -.7"
" -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1],1./(1+exp(-8*[-1 -.9"
" -.8 -.7 -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1]))+.01)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    System {
		    Name		    "logsig"
		    Location		    [260, 574, 703, 704]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Block {
		    BlockType		    Inport
		    Name		    "n"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    PortWidth		    "-1"
		    SampleTime		    "-1"
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Exp"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [155, 25, 185, 55]
		    Operator		    exp
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "Gain"
		    Position		    [90, 25, 120, 55]
		    Gain		    "-1"
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Reciprocal"
		    Ports		    [1, 1, 0, 0, 0]
		    Position		    [295, 35, 325, 65]
		    Operator		    reciprocal
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [225, 32, 255, 63]
		    Inputs		    "++"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "one"
		    Position		    [155, 75, 175, 95]
		    Value		    "1"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a"
		    Position		    [370, 43, 400, 57]
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Reciprocal"
		    SrcPort		    1
		    DstBlock		    "a"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "Reciprocal"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "one"
		    SrcPort		    1
		    Points		    [30, 0]
		    DstBlock		    "Sum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Exp"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Gain"
		    SrcPort		    1
		    DstBlock		    "Exp"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "n"
		    SrcPort		    1
		    DstBlock		    "Gain"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "netsum"
		    Ports		    [2, 1, 0, 0, 0]
		    Position		    [240, 60, 260, 80]
		    BackgroundColor	    lightBlue
		    Inputs		    "2"
		    MaskDisplay		    "disp('+')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    none
		    MaskIconUnits	    autoscale
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a{2}"
		    Position		    [360, 60, 380, 80]
		    BackgroundColor	    magenta
		    Port		    "1"
		    OutputWhenDisabled	    held
		    InitialOutput	    "[0;0]"
		    }
		    Line {
		    SrcBlock		    "a{1} "
		    SrcPort		    1
		    DstBlock		    "Delays 1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Delays 1"
		    SrcPort		    1
		    DstBlock		    "LW{2,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "LW{2,1}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "b{2}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "netsum"
		    SrcPort		    1
		    DstBlock		    "logsig"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "logsig"
		    SrcPort		    1
		    DstBlock		    "a{2}"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Goto
		  Name			  "a{1}"
		  Position		  [380, 40, 400, 60]
		  GotoTag		  "feedback1"
		  TagVisibility		  local
		  MaskDisplay		  "plot(cos(0:.1:2*pi),sin(0:.1:2*pi))"
		  MaskIconFrame		  off
		  MaskIconOpaque	  on
		  MaskIconRotate	  none
		  MaskIconUnits		  autoscale
		}
		Block {
		  BlockType		  Outport
		  Name			  "y{1}"
		  Position		  [380, 120, 400, 140]
		  BackgroundColor	  magenta
		  Port			  "1"
		  OutputWhenDisabled	  held
		  InitialOutput		  "[0;0]"
		}
		Line {
		  SrcBlock		  "p{1}"
		  SrcPort		  1
		  DstBlock		  "Layer 1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Layer 1"
		  SrcPort		  1
		  DstBlock		  "a{1}"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  " a{1} "
		  SrcPort		  1
		  DstBlock		  "Layer 2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Layer 2"
		  SrcPort		  1
		  DstBlock		  "y{1}"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Normalizer\nPower"
	      Position		      [85, 55, 145, 85]
	      Expr		      "(u-ess_MMi(1,1))/(ess_MMi(1,2)-ess_MMi("
"1,1))"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Normalizer\nSOC"
	      Position		      [85, 155, 145, 185]
	      Expr		      "(u-ess_MMi(2,1))/(ess_MMi(2,2)-ess_MMi("
"2,1))"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "V"
	      Position		      [460, 160, 480, 180]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "i"
	      Position		      [450, 60, 470, 80]
	      FontName		      "Arial"
	      Port		      "2"
	      OutputWhenDisabled      reset
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      DstBlock		      "Neural Network"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Neural Network"
	      SrcPort		      1
	      DstBlock		      "Demux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Preq"
	      SrcPort		      1
	      DstBlock		      "Normalizer\nPower"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Normalizer\nPower"
	      SrcPort		      1
	      Points		      [0, 45]
	      DstBlock		      "Mux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "Normalizer\nSOC"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Normalizer\nSOC"
	      SrcPort		      1
	      Points		      [0, -35]
	      DstBlock		      "Mux"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "De-Normalizer2\nCurrent"
	      SrcPort		      1
	      DstBlock		      "i"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      1
	      Points		      [0, -45]
	      DstBlock		      "De-Normalizer2\nCurrent"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      2
	      Points		      [0, 35]
	      DstBlock		      "De-Normalizer1\nVoltage"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "De-Normalizer1\nVoltage"
	      SrcPort		      1
	      DstBlock		      "V"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "No Thermal\nmodel"
	  Ports			  [0, 0, 0, 0, 0]
	  Position		  [775, 390, 805, 470]
	  FontName		  "Arial"
	  ShowPortLabels	  off
	  System {
	    Name		    "No Thermal\nmodel"
	    Location		    [78, 108, 387, 310]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Constant
	      Name		      "Const1"
	      Position		      [80, 45, 100, 65]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const2"
	      Position		      [55, 75, 110, 95]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "amb_tmp"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const3"
	      Position		      [85, 115, 105, 135]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS1"
	      Position		      [125, 47, 205, 63]
	      NamePlacement	      alternate
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_pwr_loss_a"
	      Buffer		      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS2"
	      Position		      [130, 78, 200, 92]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_mod_tmp"
	      Buffer		      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS3"
	      Position		      [130, 98, 200, 112]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_tmp"
	      Buffer		      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS4"
	      Position		      [130, 119, 205, 131]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_th_pwr"
	      Buffer		      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	    }
	    Line {
	      SrcBlock		      "Const1"
	      SrcPort		      1
	      DstBlock		      "To WS1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const2"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		DstBlock		"To WS2"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To WS3"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Const3"
	      SrcPort		      1
	      DstBlock		      "To WS4"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Product
	  Name			  "Pout"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [560, 268, 590, 292]
	  Inputs		  "2"
	}
	Block {
	  BlockType		  Switch
	  Name			  "Preq=0\ncondition"
	  Position		  [845, 95, 875, 125]
	  Threshold		  "eps"
	}
	Block {
	  BlockType		  RelationalOperator
	  Name			  "Relational\nOperator"
	  Position		  [330, 92, 360, 123]
	  ShowName		  off
	  Operator		  "=="
	}
	Block {
	  BlockType		  RelationalOperator
	  Name			  "Relational\nOperator1"
	  Position		  [440, 342, 470, 373]
	  ShowName		  off
	  Operator		  "=="
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "SOC\nalgorithm"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [365, 376, 395, 409]
	  Orientation		  left
	  FontName		  "Arial"
	  ShowPortLabels	  off
	  System {
	    Name		    "SOC\nalgorithm"
	    Location		    [427, 629, 1207, 901]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "(A)"
	      Position		      [15, 35, 35, 55]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Inport
	      Name		      "tmp\n(C)"
	      Position		      [20, 125, 40, 145]
	      Port		      "2"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "(sec->hrs)"
	      Position		      [265, 43, 330, 77]
	      Gain		      "1/3600"
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "0 <= SOC <= 1"
	      Position		      [650, 121, 680, 139]
	      UpperLimit	      "1"
	      LowerLimit	      "0"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "A-h\nremaining"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [505, 85, 525, 105]
	      Inputs		      "-+"
	    }
	    Block {
	      BlockType		      Integrator
	      Name		      "Ah used"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [425, 50, 445, 70]
	      ExternalReset	      none
	      InitialConditionSource  external
	      InitialCondition	      "(1-ess_init_soc)*ess_max_ah_cap"
	      LimitOutput	      off
	      UpperSaturationLimit    "inf"
	      LowerSaturationLimit    "-inf"
	      ShowSaturationPort      off
	      ShowStatePort	      off
	      AbsoluteTolerance	      "auto"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Fcn"
	      Position		      [500, 150, 540, 170]
	      ShowName		      off
	      Expr		      "1/u"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Fcn1"
	      Position		      [285, 96, 385, 114]
	      ShowName		      off
	      Expr		      "(1-ess_init_soc)*u"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "SOC"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [580, 118, 610, 142]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Switch"
	      Position		      [205, 35, 235, 85]
	      ShowName		      off
	      Threshold		      "0"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "adjusted A"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [135, 63, 165, 87]
	      Inputs		      "2"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "coul eff"
	      Position		      [75, 88, 105, 112]
	      InputValues	      "ess_tmp"
	      OutputValues	      "ess_coulombic_eff"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "max cap"
	      Position		      [200, 128, 230, 152]
	      InputValues	      "ess_tmp"
	      OutputValues	      "ess_max_ah_cap"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "SOC1"
	      Position		      [720, 120, 740, 140]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "(A)"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[130, 0]
		Branch {
		  Points		  [0, 15]
		  DstBlock		  "Switch"
		  DstPort		  2
		}
		Branch {
		  DstBlock		  "Switch"
		  DstPort		  1
		}
	      }
	      Branch {
		Points			[0, 25]
		DstBlock		"adjusted A"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Switch"
	      SrcPort		      1
	      DstBlock		      "(sec->hrs)"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "(sec->hrs)"
	      SrcPort		      1
	      Points		      [75, 0]
	      DstBlock		      "Ah used"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Ah used"
	      SrcPort		      1
	      Points		      [40, 0]
	      DstBlock		      "A-h\nremaining"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Fcn"
	      SrcPort		      1
	      Points		      [20, 0]
	      DstBlock		      "SOC"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "0 <= SOC <= 1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "A-h\nremaining"
	      SrcPort		      1
	      Points		      [35, 0]
	      DstBlock		      "SOC"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "0 <= SOC <= 1"
	      SrcPort		      1
	      DstBlock		      "SOC1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "tmp\n(C)"
	      SrcPort		      1
	      Points		      [15, 0]
	      Branch {
		Points			[125, 0]
		DstBlock		"max cap"
		DstPort			1
	      }
	      Branch {
		DstBlock		"coul eff"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "coul eff"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "adjusted A"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "adjusted A"
	      SrcPort		      1
	      DstBlock		      "Switch"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "max cap"
	      SrcPort		      1
	      Points		      [30, 0]
	      Branch {
		Points			[170, 0; 0, -30; 50, 0]
		Branch {
		  Points		  [5, 0]
		  DstBlock		  "A-h\nremaining"
		  DstPort		  2
		}
		Branch {
		  DstBlock		  "Fcn"
		  DstPort		  1
		}
	      }
	      Branch {
		Points			[0, -35]
		DstBlock		"Fcn1"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Fcn1"
	      SrcPort		      1
	      Points		      [20, 0]
	      DstBlock		      "Ah used"
	      DstPort		      2
	    }
	    Annotation {
	      Position		      [533, 207]
	      Text		      "SOC=(Max Ah capacity-Ah used)/Max Ah ca"
"pacity"
	    }
	  }
	}
	Block {
	  BlockType		  Switch
	  Name			  "SOC=0\n->i=0"
	  Position		  [490, 305, 520, 335]
	  Threshold		  "eps"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace10"
	  Position		  [570, 374, 645, 396]
	  VariableName		  "ess_current"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace11"
	  Position		  [710, 164, 785, 186]
	  VariableName		  "ess_volt"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace8"
	  Position		  [40, 225, 110, 245]
	  Orientation		  left
	  VariableName		  "ess_pwr_out_r"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace9"
	  Position		  [955, 179, 1030, 201]
	  VariableName		  "ess_pwr_out_a"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "max pack\npwr (W)"
	  Ports			  [1, 1, 0, 0, 0]
	  Position		  [355, 505, 385, 535]
	  ShowPortLabels	  off
	  System {
	    Name		    "max pack\npwr (W)"
	    Location		    [502, 536, 957, 673]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [35, 43, 65, 57]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries"
	      Position		      [245, 35, 295, 65]
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "max power"
	      Position		      [165, 35, 195, 65]
	      InputValues	      "ess_max_p_soc"
	      OutputValues	      "ess_max_p"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "ess\ndischarge\npwr"
	      Position		      [355, 40, 375, 60]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "max power"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "max power"
	      SrcPort		      1
	      DstBlock		      "# batteries"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries"
	      SrcPort		      1
	      DstBlock		      "ess\ndischarge\npwr"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "stop sim"
	  Ports			  [1, 0, 1, 0, 0]
	  Position		  [215, 379, 275, 411]
	  Orientation		  left
	  ShowPortLabels	  on
	  System {
	    Name		    "stop sim"
	    Location		    [423, 258, 819, 468]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [75, 85, 95, 105]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [170, 25, 190, 45]
	      StatesWhenEnabling      held
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [95, 145, 165, 165]
	      Orientation	      up
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      ".001"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [185, 88, 215, 112]
	      Operator		      "<"
	    }
	    Block {
	      BlockType		      Stop
	      Name		      "Stop Simulation"
	      Position		      [255, 83, 295, 117]
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      Points		      [0, -35]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      DstBlock		      "Stop Simulation"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Outport
	  Name			  "power available\nto bus (W)"
	  Position		  [980, 100, 1000, 120]
	  FontName		  "Arial"
	  Port			  "1"
	  OutputWhenDisabled	  held
	  InitialOutput		  "0"
	}
	Line {
	  SrcBlock		  "Const"
	  SrcPort		  1
	  DstBlock		  "stop sim"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "SOC\nalgorithm"
	  SrcPort		  1
	  Points		  [-15, 0]
	  Branch {
	    Points		    [-30, 0]
	    Branch {
	      DstBlock		      "stop sim"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [0, 65]
	      Branch {
		DstBlock		"Goto <sdo>, <cs>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 60]
		DstBlock		"max pack\npwr (W)"
		DstPort			1
	      }
	    }
	  }
	  Branch {
	    Points		    [0, -45]
	    Branch {
	      DstBlock		      "NNet"
	      DstPort		      2
	    }
	    Branch {
	      DstBlock		      "Relational\nOperator1"
	      DstPort		      1
	    }
	  }
	}
	Line {
	  SrcBlock		  "power req'd\ninto bus (W)"
	  SrcPort		  1
	  Points		  [15, 0]
	  Branch {
	    Points		    [0, -25]
	    DstBlock		    "To Workspace8"
	    DstPort		    1
	  }
	  Branch {
	    Points		    [15, 0]
	    Branch {
	      DstBlock		      "1/# batteries"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [0, -170; 150, 0]
	      Branch {
		DstBlock		"Relational\nOperator"
		DstPort			1
	      }
	      Branch {
		Points			[0, -30; 515, 0]
		Branch {
		  DstBlock		  "Preq=0\ncondition"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, -25]
		  DstBlock		  "Limits"
		  DstPort		  1
		}
	      }
	    }
	  }
	}
	Line {
	  SrcBlock		  "1/# batteries"
	  SrcPort		  1
	  DstBlock		  "NNet"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Const4"
	  SrcPort		  1
	  DstBlock		  "Relational\nOperator"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Logical\nOperator"
	  SrcPort		  1
	  DstBlock		  "NNet"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "Relational\nOperator"
	  SrcPort		  1
	  Points		  [20, 0]
	  Branch {
	    DstBlock		    "Preq=0\ncondition"
	    DstPort		    2
	  }
	  Branch {
	    DstBlock		    "Logical\nOperator"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "max pack\npwr (W)"
	  SrcPort		  1
	  DstBlock		  "Goto <cs>1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Pout"
	  SrcPort		  1
	  DstBlock		  "# batteries1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "NNet"
	  SrcPort		  1
	  Points		  [125, 0]
	  Branch {
	    DstBlock		    "Pout"
	    DstPort		    1
	  }
	  Branch {
	    Points		    [0, -40]
	    DstBlock		    "# batteries2"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "# batteries2"
	  SrcPort		  1
	  Points		  [0, 0]
	  Branch {
	    DstBlock		    "Goto <mc>, <gc>, <sdo>"
	    DstPort		    1
	  }
	  Branch {
	    Points		    [0, -45]
	    DstBlock		    "To Workspace11"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "# batteries1"
	  SrcPort		  1
	  Points		  [130, 0]
	  DstBlock		  "Preq=0\ncondition"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "Preq=0\ncondition"
	  SrcPort		  1
	  Points		  [25, 0]
	  Branch {
	    Points		    [10, 0]
	    Branch {
	      DstBlock		      "power available\nto bus (W)"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [0, 80]
	      DstBlock		      "To Workspace9"
	      DstPort		      1
	    }
	  }
	  Branch {
	    Points		    [0, -35]
	    DstBlock		    "Limits"
	    DstPort		    2
	  }
	}
	Line {
	  SrcBlock		  "Const2"
	  SrcPort		  1
	  Points		  [-160, 0]
	  DstBlock		  "SOC\nalgorithm"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Const6"
	  SrcPort		  1
	  DstBlock		  "SOC=0\n->i=0"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "NNet"
	  SrcPort		  2
	  Points		  [10, 0; 0, 30]
	  DstBlock		  "SOC=0\n->i=0"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "Const5"
	  SrcPort		  1
	  DstBlock		  "Relational\nOperator1"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Relational\nOperator1"
	  SrcPort		  1
	  DstBlock		  "SOC=0\n->i=0"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "SOC=0\n->i=0"
	  SrcPort		  1
	  Points		  [5, 0]
	  Branch {
	    Points		    [0, 65]
	    Branch {
	      DstBlock		      "SOC\nalgorithm"
	      DstPort		      1
	    }
	    Branch {
	      DstBlock		      "To Workspace10"
	      DstPort		      1
	    }
	  }
	  Branch {
	    Points		    [0, -35]
	    DstBlock		    "Pout"
	    DstPort		    2
	  }
	}
      }
    }
    Block {
      BlockType		      SubSystem
      Name		      "energy storage <ess>\nfundamental model"
      Ports		      [1, 1, 0, 0, 0]
      Position		      [125, 404, 165, 486]
      ShowPortLabels	      off
      System {
	Name			"energy storage <ess>\nfundamental model"
	Location		[83, 419, 1073, 922]
	Open			off
	ToolBar			off
	StatusBar		off
	ScreenColor		white
	PaperOrientation	landscape
	PaperPositionMode	auto
	PaperType		usletter
	PaperUnits		inches
	Block {
	  BlockType		  Inport
	  Name			  "power req'd\ninto bus (W)"
	  Position		  [35, 130, 55, 150]
	  FontName		  "Arial"
	  Port			  "1"
	  PortWidth		  "-1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  Gain
	  Name			  "# batteries"
	  Position		  [570, 85, 620, 105]
	  Gain			  "ess_module_num"
	}
	Block {
	  BlockType		  Gain
	  Name			  "# batteries1"
	  Position		  [625, 126, 675, 144]
	  Gain			  "ess_module_num"
	}
	Block {
	  BlockType		  Gain
	  Name			  "1/# batteries"
	  Position		  [175, 125, 225, 155]
	  Gain			  "1/ess_module_num"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "Block NOTES"
	  Ports			  [0, 0, 0, 0, 0]
	  Position		  [860, 420, 916, 460]
	  BackgroundColor	  green
	  ShowName		  off
	  ShowPortLabels	  on
	  MaskDisplay		  "disp('Block\\nNOTES')"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  none
	  MaskIconUnits		  autoscale
	  System {
	    Name		    "Block NOTES"
	    Location		    [211, 187, 723, 361]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Annotation {
	      Position		      [256, 77]
	      Text		      "Fundamentally based SOC model developed"
" at BYU\nFiles needed:\ninput1.dat\ninput2.dat\ninput3.dat\nnrel13cs.dll"
	    }
	  }
	}
	Block {
	  BlockType		  Constant
	  Name			  "C->K"
	  Position		  [375, 331, 405, 349]
	  Value			  "273"
	}
	Block {
	  BlockType		  Clock
	  Name			  "Clock"
	  Position		  [300, 90, 320, 110]
	  Location		  [30, 40, 140, 75]
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const"
	  Position		  [850, 215, 920, 235]
	  Orientation		  down
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "enable_stop"
	}
	Block {
	  BlockType		  Demux
	  Name			  "Demux"
	  Ports			  [1, 6, 0, 0, 0]
	  Position		  [500, 105, 520, 175]
	  ShowName		  off
	  Outputs		  "6"
	}
	Block {
	  BlockType		  MATLABFcn
	  Name			  "Discharge Model\nOutputs:\nPreq(W)\nPavail "
"(W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	  Position		  [415, 125, 475, 155]
	  MATLABFcn		  "fund_byu(u(2),u(1)+t_soc,1,u(3))"
	  OutputWidth		  "-1"
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <cs>1"
	  Position		  [700, 290, 780, 310]
	  GotoTag		  "ess_max_pwr"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <mc>, <gc>, <sdo>"
	  Position		  [750, 170, 830, 190]
	  GotoTag		  "bus_voltage"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <sdo>, <cs>"
	  Position		  [645, 229, 690, 251]
	  GotoTag		  "SOC"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Memory
	  Name			  "Memory"
	  Position		  [695, 120, 725, 150]
	  ShowName		  off
	  X0			  "12*ess_module_num"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Memory
	  Name			  "Memory1"
	  Position		  [560, 220, 585, 250]
	  ShowName		  off
	  X0			  "ess_init_soc"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Mux
	  Name			  "Mux"
	  Ports			  [3, 1, 0, 0, 0]
	  Position		  [385, 112, 400, 168]
	  ShowName		  off
	  Inputs		  "3"
	}
	Block {
	  BlockType		  RelationalOperator
	  Name			  "Relational\nOperator"
	  Position		  [235, 167, 265, 198]
	  ShowName		  off
	  Operator		  ">"
	}
	Block {
	  BlockType		  Sum
	  Name			  "Sum1"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [375, 282, 405, 313]
	  Orientation		  left
	  Inputs		  "++"
	}
	Block {
	  BlockType		  Switch
	  Name			  "Switch"
	  Position		  [290, 150, 320, 180]
	  ShowName		  off
	  Threshold		  "eps"
	}
	Block {
	  BlockType		  Memory
	  Name			  "Temp (in C)"
	  Position		  [445, 275, 470, 305]
	  Orientation		  left
	  X0			  "amb_tmp"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Terminator
	  Name			  "Terminator1"
	  Position		  [545, 60, 565, 80]
	  ShowName		  off
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS1"
	  Position		  [574, 460, 656, 475]
	  Orientation		  down
	  NamePlacement		  alternate
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_pwr_loss_a"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS2"
	  Position		  [750, 403, 820, 417]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_mod_tmp"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS3"
	  Position		  [750, 423, 820, 437]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_air_tmp"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS4"
	  Position		  [750, 444, 825, 456]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_air_th_pwr"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace10"
	  Position		  [575, 177, 640, 203]
	  ShowName		  off
	  VariableName		  "ess_current"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace11"
	  Position		  [755, 124, 830, 146]
	  VariableName		  "ess_voltage"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace8"
	  Position		  [70, 185, 140, 205]
	  Orientation		  left
	  VariableName		  "ess_pwr_out_r"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace9"
	  Position		  [685, 49, 760, 71]
	  ShowName		  off
	  VariableName		  "ess_pwr_out_a"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  Constant
	  Name			  "do ess calcs?"
	  Position		  [655, 375, 715, 390]
	  Orientation		  down
	  ShowName		  off
	  Value			  "ess_th_calc"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "ess tmp"
	  Ports			  [1, 3, 1, 0, 0]
	  Position		  [640, 403, 730, 457]
	  ShowPortLabels	  on
	  System {
	    Name		    "ess tmp"
	    Location		    [431, 254, 962, 524]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "Qess_gen"
	      Position		      [25, 205, 45, 225]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [390, 217, 420, 243]
	      StatesWhenEnabling      reset
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "#of mods"
	      Position		      [390, 88, 415, 112]
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/#of mods"
	      Position		      [95, 203, 120, 227]
	      Gain		      "1/ess_module_num"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/mcp"
	      Position		      [380, 153, 405, 177]
	      Gain		      "1/(ess_module_mass*ess_mod_cp)"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [445, 220, 501, 260]
	      BackgroundColor	      green
	      ShowName		      off
	      ShowPortLabels	      on
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      System {
		Name			"Block NOTES"
		Location		[505, 510, 924, 573]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Annotation {
		  Position		  [207, 33]
		  Text			  "This block models the thermal behav"
"ior of a battery module with active air cooling.\nThe module is modeled as a "
"single lumped thermal mass.  \nThe fan is on whenever the battery temp is > t"
"he set temp."
		}
	      }
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [250, 165, 285, 185]
	      Orientation	      left
	      FontName		      "Arial"
	      X0		      "cyc_mph(1,2)*.447"
	      InheritSampleTime	      off
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory1"
	      Position		      [100, 30, 135, 50]
	      Orientation	      left
	      FontName		      "Arial"
	      X0		      "cyc_mph(1,2)*.447"
	      InheritSampleTime	      off
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux20"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [195, 84, 200, 156]
	      NamePlacement	      alternate
	      ShowName		      off
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "Qc"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [350, 114, 360, 221]
	      ShowName		      off
	      Inputs		      "++"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Qess_case"
	      Position		      [235, 108, 315, 132]
	      NamePlacement	      alternate
	      FontName		      "Arial"
	      Expr		      "(u(2) - u(1))/u(3)"
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "Saturation3"
	      Position		      [190, 29, 200, 51]
	      Orientation	      left
	      ShowName		      off
	      UpperLimit	      "1"
	      LowerLimit	      "0"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Tair,ave"
	      Ports		      [1, 2, 1, 0, 0]
	      Position		      [30, 107, 140, 158]
	      ShowPortLabels	      on
	      System {
		Name			"Tair,ave"
		Location		[467, 91, 867, 319]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "Qess_case"
		  Position		  [45, 35, 65, 55]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  [0, 0, 0, 0, 0]
		  Position		  [265, 167, 295, 193]
		  StatesWhenEnabling	  reset
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  [0, 0, 0, 0, 0]
		  Position		  [325, 165, 381, 205]
		  BackgroundColor	  green
		  ShowName		  off
		  ShowPortLabels	  on
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  none
		  MaskIconUnits		  autoscale
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		  }
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Tamb-(Q/mcp)/2"
		  Position		  [90, 34, 330, 56]
		  Expr			  "amb_tmp - (u(1)/(ess_mod_airflow*ai"
"r_cp))/2 "
		}
		Block {
		  BlockType		  Constant
		  Name			  "do ex calcs?1"
		  Position		  [35, 105, 115, 125]
		  ShowName		  off
		  Value			  "ess_th_res_on"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair_ave"
		  Position		  [355, 35, 375, 55]
		  Port			  "1"
		  OutputWhenDisabled	  reset
		  InitialOutput		  "amb_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Th Res"
		  Position		  [355, 105, 375, 125]
		  Port			  "2"
		  OutputWhenDisabled	  reset
		  InitialOutput		  "ess_th_res_off"
		}
		Line {
		  SrcBlock		  "Tamb-(Q/mcp)/2"
		  SrcPort		  1
		  DstBlock		  "Tair_ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  DstBlock		  "Tamb-(Q/mcp)/2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "do ex calcs?1"
		  SrcPort		  1
		  DstBlock		  "Th Res"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Integrator
	      Name		      "Tess2"
	      Ports		      [1, 1, 0, 0, 0]
	      Position		      [420, 155, 440, 175]
	      ExternalReset	      none
	      InitialConditionSource  internal
	      InitialCondition	      "ess_mod_init_tmp"
	      LimitOutput	      off
	      UpperSaturationLimit    "inf"
	      LowerSaturationLimit    "-inf"
	      ShowSaturationPort      off
	      ShowStatePort	      off
	      AbsoluteTolerance	      "auto"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "thermostat"
	      Position		      [235, 29, 340, 51]
	      Orientation	      left
	      NamePlacement	      alternate
	      FontName		      "Arial"
	      Expr		      "u(1) - ess_set_tmp"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Tess"
	      Position		      [470, 155, 490, 175]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Tair"
	      Position		      [470, 60, 490, 80]
	      NamePlacement	      alternate
	      Port		      "2"
	      OutputWhenDisabled      held
	      InitialOutput	      "[]"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Qair"
	      Position		      [470, 90, 490, 110]
	      Port		      "3"
	      OutputWhenDisabled      reset
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Qc"
	      SrcPort		      1
	      DstBlock		      "1/mcp"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Qess_case"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[10, 0]
		DstBlock		"Qc"
		DstPort			1
	      }
	      Branch {
		Points			[0, 55]
		DstBlock		"Memory"
		DstPort			1
	      }
	      Branch {
		Points			[0, -20]
		DstBlock		"#of mods"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "1/mcp"
	      SrcPort		      1
	      DstBlock		      "Tess2"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Tess2"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		DstBlock		"Tess"
		DstPort			1
	      }
	      Branch {
		Points			[0, -85; -80, 0]
		Branch {
		  Points		  [-185, 0]
		  DstBlock		  "Mux20"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, -40]
		  DstBlock		  "thermostat"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Qess_gen"
	      SrcPort		      1
	      DstBlock		      "1/#of mods"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "1/#of mods"
	      SrcPort		      1
	      Points		      [210, 0]
	      DstBlock		      "Qc"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "thermostat"
	      SrcPort		      1
	      DstBlock		      "Saturation3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Saturation3"
	      SrcPort		      1
	      DstBlock		      "Memory1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory1"
	      SrcPort		      1
	      Points		      [-10, 0]
	      DstBlock		      "Tair,ave"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [-230, 0]
	      DstBlock		      "Tair,ave"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "#of mods"
	      SrcPort		      1
	      DstBlock		      "Qair"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux20"
	      SrcPort		      1
	      DstBlock		      "Qess_case"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Tair,ave"
	      SrcPort		      2
	      DstBlock		      "Mux20"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Tair,ave"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		DstBlock		"Mux20"
		DstPort			2
	      }
	      Branch {
		Points			[0, -50]
		DstBlock		"Tair"
		DstPort			1
	      }
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "max pack\npwr (W)"
	  Ports			  [1, 1, 0, 0, 0]
	  Position		  [635, 285, 665, 315]
	  ShowPortLabels	  off
	  System {
	    Name		    "max pack\npwr (W)"
	    Location		    [498, 540, 953, 677]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [35, 43, 65, 57]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries"
	      Position		      [245, 35, 295, 65]
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "max power"
	      Position		      [165, 35, 195, 65]
	      InputValues	      "ess_max_p_soc"
	      OutputValues	      "ess_max_p"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "ess\ndischarge\npwr"
	      Position		      [355, 40, 375, 60]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "max power"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "max power"
	      SrcPort		      1
	      DstBlock		      "# batteries"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries"
	      SrcPort		      1
	      DstBlock		      "ess\ndischarge\npwr"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Constant
	  Name			  "pzero"
	  Position		  [240, 206, 270, 224]
	  Value			  "0"
	}
	Block {
	  BlockType		  Constant
	  Name			  "soc"
	  Position		  [185, 182, 220, 198]
	  Value			  ".01"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "stop sim"
	  Ports			  [1, 0, 1, 0, 0]
	  Position		  [855, 249, 915, 281]
	  ShowPortLabels	  on
	  System {
	    Name		    "stop sim"
	    Location		    [425, 256, 821, 466]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [75, 85, 95, 105]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [170, 25, 190, 45]
	      StatesWhenEnabling      held
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [95, 145, 165, 165]
	      Orientation	      up
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0.1"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [185, 88, 215, 112]
	      Operator		      "<"
	    }
	    Block {
	      BlockType		      Stop
	      Name		      "Stop Simulation"
	      Position		      [255, 83, 295, 117]
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      Points		      [0, -35]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      DstBlock		      "Stop Simulation"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Outport
	  Name			  "power available\nto bus (W)"
	  Position		  [870, 85, 890, 105]
	  FontName		  "Arial"
	  Port			  "1"
	  OutputWhenDisabled	  held
	  InitialOutput		  "0"
	}
	Line {
	  SrcBlock		  "Mux"
	  SrcPort		  1
	  DstBlock		  "Discharge Model\nOutputs:\nPreq(W)\nPavail "
"(W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Discharge Model\nOutputs:\nPreq(W)\nPavail "
"(W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	  SrcPort		  1
	  DstBlock		  "Demux"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  5
	  Points		  [20, 0]
	  DstBlock		  "Memory1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  4
	  Points		  [35, 0]
	  DstBlock		  "To Workspace10"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  2
	  Points		  [30, 0]
	  DstBlock		  "# batteries"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Clock"
	  SrcPort		  1
	  Points		  [45, 0]
	  DstBlock		  "Mux"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "power req'd\ninto bus (W)"
	  SrcPort		  1
	  Points		  [95, 0]
	  Branch {
	    DstBlock		    "To Workspace8"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "1/# batteries"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "pzero"
	  SrcPort		  1
	  DstBlock		  "Switch"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "Relational\nOperator"
	  SrcPort		  1
	  Points		  [0, -20]
	  DstBlock		  "Switch"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "soc"
	  SrcPort		  1
	  DstBlock		  "Relational\nOperator"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "1/# batteries"
	  SrcPort		  1
	  Points		  [45, 0]
	  DstBlock		  "Switch"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Switch"
	  SrcPort		  1
	  Points		  [35, 0; 0, -25]
	  DstBlock		  "Mux"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  1
	  Points		  [0, -45]
	  DstBlock		  "Terminator1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "# batteries"
	  SrcPort		  1
	  Points		  [45, 0]
	  Branch {
	    DstBlock		    "To Workspace9"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "power available\nto bus (W)"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "# batteries1"
	  SrcPort		  1
	  DstBlock		  "Memory"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  3
	  DstBlock		  "# batteries1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Memory"
	  SrcPort		  1
	  Points		  [5, 0]
	  Branch {
	    DstBlock		    "To Workspace11"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "Goto <mc>, <gc>, <sdo>"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "Memory1"
	  SrcPort		  1
	  Points		  [15, 0; 0, 5]
	  Branch {
	    Points		    [0, 25]
	    Branch {
	      Points		      [-425, 0; 0, -90]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [10, 0]
	      Branch {
		DstBlock		"stop sim"
		DstPort			1
	      }
	      Branch {
		Points			[0, 35]
		DstBlock		"max pack\npwr (W)"
		DstPort			1
	      }
	    }
	  }
	  Branch {
	    DstBlock		    "Goto <sdo>, <cs>"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "Temp (in C)"
	  SrcPort		  1
	  DstBlock		  "Sum1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "C->K"
	  SrcPort		  1
	  Points		  [10, 0]
	  DstBlock		  "Sum1"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Sum1"
	  SrcPort		  1
	  DstBlock		  "Mux"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "Const"
	  SrcPort		  1
	  DstBlock		  "stop sim"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "max pack\npwr (W)"
	  SrcPort		  1
	  DstBlock		  "Goto <cs>1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  6
	  Points		  [0, 265; 90, 0]
	  Branch {
	    DstBlock		    "ess tmp"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "To WS1"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "do ess calcs?"
	  SrcPort		  1
	  DstBlock		  "ess tmp"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  2
	  DstBlock		  "To WS3"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  3
	  DstBlock		  "To WS4"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  1
	  Points		  [0, 0]
	  Branch {
	    DstBlock		    "To WS2"
	    DstPort		    1
	  }
	  Branch {
	    Points		    [0, -45; -250, 0]
	    DstBlock		    "Temp (in C)"
	    DstPort		    1
	  }
	}
      }
    }
    Block {
      BlockType		      SubSystem
      Name		      "energy storage <ess>\noptima\nfundamental model"
      Ports		      [1, 1, 0, 0, 0]
      Position		      [280, 399, 320, 481]
      ShowPortLabels	      off
      System {
	Name			"energy storage <ess>\noptima\nfundamental mod"
"el"
	Location		[34, 298, 1024, 801]
	Open			off
	ToolBar			off
	StatusBar		off
	ScreenColor		white
	PaperOrientation	landscape
	PaperPositionMode	auto
	PaperType		usletter
	PaperUnits		inches
	Block {
	  BlockType		  Inport
	  Name			  "power req'd\ninto bus (W)"
	  Position		  [35, 130, 55, 150]
	  FontName		  "Arial"
	  Port			  "1"
	  PortWidth		  "-1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  Gain
	  Name			  "# batteries"
	  Position		  [570, 85, 620, 105]
	  Gain			  "ess_module_num"
	}
	Block {
	  BlockType		  Gain
	  Name			  "# batteries1"
	  Position		  [625, 126, 675, 144]
	  Gain			  "ess_module_num"
	}
	Block {
	  BlockType		  Gain
	  Name			  "1/# batteries"
	  Position		  [175, 125, 225, 155]
	  Gain			  "1/ess_module_num"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "Block NOTES"
	  Ports			  [0, 0, 0, 0, 0]
	  Position		  [860, 420, 916, 460]
	  BackgroundColor	  green
	  ShowName		  off
	  ShowPortLabels	  on
	  MaskDisplay		  "disp('Block\\nNOTES')"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  none
	  MaskIconUnits		  autoscale
	  System {
	    Name		    "Block NOTES"
	    Location		    [211, 187, 723, 361]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Annotation {
	      Position		      [256, 77]
	      Text		      "Fundamentally based SOC model developed"
" at BYU\nFiles needed:\ninput1.dat\ninput2.dat\ninput3.dat\nnrel13cs.dll"
	    }
	  }
	}
	Block {
	  BlockType		  Constant
	  Name			  "C->K"
	  Position		  [375, 331, 405, 349]
	  Value			  "273"
	}
	Block {
	  BlockType		  Clock
	  Name			  "Clock"
	  Position		  [300, 90, 320, 110]
	  Location		  [30, 40, 140, 75]
	}
	Block {
	  BlockType		  Constant
	  Name			  "Const"
	  Position		  [850, 215, 920, 235]
	  Orientation		  down
	  ShowName		  off
	  FontName		  "Arial"
	  Value			  "enable_stop"
	}
	Block {
	  BlockType		  Demux
	  Name			  "Demux"
	  Ports			  [1, 6, 0, 0, 0]
	  Position		  [500, 105, 520, 175]
	  ShowName		  off
	  Outputs		  "6"
	}
	Block {
	  BlockType		  MATLABFcn
	  Name			  "Discharge Model\nOutputs:\nPreq(W)\nPavail "
"(W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	  Position		  [415, 125, 475, 155]
	  MATLABFcn		  "fund_byuop(u(2),u(1)+t_soc,1,u(3))"
	  OutputWidth		  "-1"
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <cs>1"
	  Position		  [700, 290, 780, 310]
	  GotoTag		  "ess_max_pwr"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <mc>, <gc>, <sdo>"
	  Position		  [750, 170, 830, 190]
	  GotoTag		  "bus_voltage"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Goto
	  Name			  "Goto <sdo>, <cs>"
	  Position		  [645, 229, 690, 251]
	  GotoTag		  "SOC"
	  TagVisibility		  global
	}
	Block {
	  BlockType		  Memory
	  Name			  "Memory"
	  Position		  [695, 120, 725, 150]
	  ShowName		  off
	  X0			  "12*ess_module_num"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Memory
	  Name			  "Memory1"
	  Position		  [560, 220, 585, 250]
	  ShowName		  off
	  X0			  "ess_init_soc"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Mux
	  Name			  "Mux"
	  Ports			  [3, 1, 0, 0, 0]
	  Position		  [385, 112, 400, 168]
	  ShowName		  off
	  Inputs		  "3"
	}
	Block {
	  BlockType		  RelationalOperator
	  Name			  "Relational\nOperator"
	  Position		  [235, 167, 265, 198]
	  ShowName		  off
	  Operator		  ">"
	}
	Block {
	  BlockType		  Sum
	  Name			  "Sum1"
	  Ports			  [2, 1, 0, 0, 0]
	  Position		  [375, 282, 405, 313]
	  Orientation		  left
	  Inputs		  "++"
	}
	Block {
	  BlockType		  Switch
	  Name			  "Switch"
	  Position		  [290, 150, 320, 180]
	  ShowName		  off
	  Threshold		  "eps"
	}
	Block {
	  BlockType		  Memory
	  Name			  "Temp (in C)"
	  Position		  [445, 275, 470, 305]
	  Orientation		  left
	  X0			  "amb_tmp"
	  InheritSampleTime	  off
	}
	Block {
	  BlockType		  Terminator
	  Name			  "Terminator1"
	  Position		  [545, 60, 565, 80]
	  ShowName		  off
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS1"
	  Position		  [574, 460, 656, 475]
	  Orientation		  down
	  NamePlacement		  alternate
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_pwr_loss_a"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS2"
	  Position		  [750, 403, 820, 417]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_mod_tmp"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS3"
	  Position		  [750, 423, 820, 437]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_air_tmp"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To WS4"
	  Position		  [750, 444, 825, 456]
	  ShowName		  off
	  FontName		  "Arial"
	  VariableName		  "ess_air_th_pwr"
	  Buffer		  "50000"
	  Decimation		  "1"
	  SampleTime		  "0"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace10"
	  Position		  [575, 177, 640, 203]
	  ShowName		  off
	  VariableName		  "ess_current"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace11"
	  Position		  [755, 124, 830, 146]
	  VariableName		  "ess_voltage"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace8"
	  Position		  [70, 185, 140, 205]
	  Orientation		  left
	  VariableName		  "ess_pwr_out_r"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  ToWorkspace
	  Name			  "To Workspace9"
	  Position		  [685, 49, 760, 71]
	  ShowName		  off
	  VariableName		  "ess_pwr_out_a"
	  Buffer		  "inf"
	  Decimation		  "1"
	  SampleTime		  "-1"
	}
	Block {
	  BlockType		  Constant
	  Name			  "do ess calcs?"
	  Position		  [655, 375, 715, 390]
	  Orientation		  down
	  ShowName		  off
	  Value			  "ess_th_calc"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "ess tmp"
	  Ports			  [1, 3, 1, 0, 0]
	  Position		  [640, 403, 730, 457]
	  ShowPortLabels	  on
	  System {
	    Name		    "ess tmp"
	    Location		    [431, 254, 962, 524]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "Qess_gen"
	      Position		      [25, 205, 45, 225]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [390, 217, 420, 243]
	      StatesWhenEnabling      reset
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "#of mods"
	      Position		      [390, 88, 415, 112]
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/#of mods"
	      Position		      [95, 203, 120, 227]
	      Gain		      "1/ess_module_num"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/mcp"
	      Position		      [380, 153, 405, 177]
	      Gain		      "1/(ess_module_mass*ess_mod_cp)"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [445, 220, 501, 260]
	      BackgroundColor	      green
	      ShowName		      off
	      ShowPortLabels	      on
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      none
	      MaskIconUnits	      autoscale
	      System {
		Name			"Block NOTES"
		Location		[505, 510, 924, 573]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Annotation {
		  Position		  [207, 33]
		  Text			  "This block models the thermal behav"
"ior of a battery module with active air cooling.\nThe module is modeled as a "
"single lumped thermal mass.  \nThe fan is on whenever the battery temp is > t"
"he set temp."
		}
	      }
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [250, 165, 285, 185]
	      Orientation	      left
	      FontName		      "Arial"
	      X0		      "cyc_mph(1,2)*.447"
	      InheritSampleTime	      off
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory1"
	      Position		      [100, 30, 135, 50]
	      Orientation	      left
	      FontName		      "Arial"
	      X0		      "cyc_mph(1,2)*.447"
	      InheritSampleTime	      off
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux20"
	      Ports		      [3, 1, 0, 0, 0]
	      Position		      [195, 84, 200, 156]
	      NamePlacement	      alternate
	      ShowName		      off
	      Inputs		      "3"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "Qc"
	      Ports		      [2, 1, 0, 0, 0]
	      Position		      [350, 114, 360, 221]
	      ShowName		      off
	      Inputs		      "++"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Qess_case"
	      Position		      [235, 108, 315, 132]
	      NamePlacement	      alternate
	      FontName		      "Arial"
	      Expr		      "(u(2) - u(1))/u(3)"
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "Saturation3"
	      Position		      [190, 29, 200, 51]
	      Orientation	      left
	      ShowName		      off
	      UpperLimit	      "1"
	      LowerLimit	      "0"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Tair,ave"
	      Ports		      [1, 2, 1, 0, 0]
	      Position		      [30, 107, 140, 158]
	      ShowPortLabels	      on
	      System {
		Name			"Tair,ave"
		Location		[467, 91, 867, 319]
		Open			off
		ToolBar			off
		StatusBar		off
		ScreenColor		white
		PaperOrientation	landscape
		PaperPositionMode	auto
		PaperType		usletter
		PaperUnits		inches
		Block {
		  BlockType		  Inport
		  Name			  "Qess_case"
		  Position		  [45, 35, 65, 55]
		  Port			  "1"
		  PortWidth		  "-1"
		  SampleTime		  "-1"
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  [0, 0, 0, 0, 0]
		  Position		  [265, 167, 295, 193]
		  StatesWhenEnabling	  reset
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  [0, 0, 0, 0, 0]
		  Position		  [325, 165, 381, 205]
		  BackgroundColor	  green
		  ShowName		  off
		  ShowPortLabels	  on
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  none
		  MaskIconUnits		  autoscale
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ToolBar		    off
		    StatusBar		    off
		    ScreenColor		    white
		    PaperOrientation	    landscape
		    PaperPositionMode	    auto
		    PaperType		    usletter
		    PaperUnits		    inches
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		  }
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Tamb-(Q/mcp)/2"
		  Position		  [90, 34, 330, 56]
		  Expr			  "amb_tmp - (u(1)/(ess_mod_airflow*ai"
"r_cp))/2 "
		}
		Block {
		  BlockType		  Constant
		  Name			  "do ex calcs?1"
		  Position		  [35, 105, 115, 125]
		  ShowName		  off
		  Value			  "ess_th_res_on"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair_ave"
		  Position		  [355, 35, 375, 55]
		  Port			  "1"
		  OutputWhenDisabled	  reset
		  InitialOutput		  "amb_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Th Res"
		  Position		  [355, 105, 375, 125]
		  Port			  "2"
		  OutputWhenDisabled	  reset
		  InitialOutput		  "ess_th_res_off"
		}
		Line {
		  SrcBlock		  "Tamb-(Q/mcp)/2"
		  SrcPort		  1
		  DstBlock		  "Tair_ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  DstBlock		  "Tamb-(Q/mcp)/2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "do ex calcs?1"
		  SrcPort		  1
		  DstBlock		  "Th Res"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Integrator
	      Name		      "Tess2"
	      Ports		      [1, 1, 0, 0, 0]
	      Position		      [420, 155, 440, 175]
	      ExternalReset	      none
	      InitialConditionSource  internal
	      InitialCondition	      "ess_mod_init_tmp"
	      LimitOutput	      off
	      UpperSaturationLimit    "inf"
	      LowerSaturationLimit    "-inf"
	      ShowSaturationPort      off
	      ShowStatePort	      off
	      AbsoluteTolerance	      "auto"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "thermostat"
	      Position		      [235, 29, 340, 51]
	      Orientation	      left
	      NamePlacement	      alternate
	      FontName		      "Arial"
	      Expr		      "u(1) - ess_set_tmp"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Tess"
	      Position		      [470, 155, 490, 175]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Tair"
	      Position		      [470, 60, 490, 80]
	      NamePlacement	      alternate
	      Port		      "2"
	      OutputWhenDisabled      held
	      InitialOutput	      "[]"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "Qair"
	      Position		      [470, 90, 490, 110]
	      Port		      "3"
	      OutputWhenDisabled      reset
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "Qc"
	      SrcPort		      1
	      DstBlock		      "1/mcp"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Qess_case"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[10, 0]
		DstBlock		"Qc"
		DstPort			1
	      }
	      Branch {
		Points			[0, 55]
		DstBlock		"Memory"
		DstPort			1
	      }
	      Branch {
		Points			[0, -20]
		DstBlock		"#of mods"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "1/mcp"
	      SrcPort		      1
	      DstBlock		      "Tess2"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Tess2"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		DstBlock		"Tess"
		DstPort			1
	      }
	      Branch {
		Points			[0, -85; -80, 0]
		Branch {
		  Points		  [-185, 0]
		  DstBlock		  "Mux20"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, -40]
		  DstBlock		  "thermostat"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Qess_gen"
	      SrcPort		      1
	      DstBlock		      "1/#of mods"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "1/#of mods"
	      SrcPort		      1
	      Points		      [210, 0]
	      DstBlock		      "Qc"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "thermostat"
	      SrcPort		      1
	      DstBlock		      "Saturation3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Saturation3"
	      SrcPort		      1
	      DstBlock		      "Memory1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory1"
	      SrcPort		      1
	      Points		      [-10, 0]
	      DstBlock		      "Tair,ave"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [-230, 0]
	      DstBlock		      "Tair,ave"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "#of mods"
	      SrcPort		      1
	      DstBlock		      "Qair"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux20"
	      SrcPort		      1
	      DstBlock		      "Qess_case"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Tair,ave"
	      SrcPort		      2
	      DstBlock		      "Mux20"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Tair,ave"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		DstBlock		"Mux20"
		DstPort			2
	      }
	      Branch {
		Points			[0, -50]
		DstBlock		"Tair"
		DstPort			1
	      }
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "max pack\npwr (W)"
	  Ports			  [1, 1, 0, 0, 0]
	  Position		  [635, 285, 665, 315]
	  ShowPortLabels	  off
	  System {
	    Name		    "max pack\npwr (W)"
	    Location		    [498, 540, 953, 677]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [35, 43, 65, 57]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries"
	      Position		      [245, 35, 295, 65]
	      Gain		      "ess_module_num"
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "max power"
	      Position		      [165, 35, 195, 65]
	      InputValues	      "ess_max_p_soc"
	      OutputValues	      "ess_max_p"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "ess\ndischarge\npwr"
	      Position		      [355, 40, 375, 60]
	      Port		      "1"
	      OutputWhenDisabled      held
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "max power"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "max power"
	      SrcPort		      1
	      DstBlock		      "# batteries"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries"
	      SrcPort		      1
	      DstBlock		      "ess\ndischarge\npwr"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Constant
	  Name			  "pzero"
	  Position		  [240, 206, 270, 224]
	  Value			  "0"
	}
	Block {
	  BlockType		  Constant
	  Name			  "soc"
	  Position		  [185, 182, 220, 198]
	  Value			  ".01"
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "stop sim"
	  Ports			  [1, 0, 1, 0, 0]
	  Position		  [855, 249, 915, 281]
	  ShowPortLabels	  on
	  System {
	    Name		    "stop sim"
	    Location		    [423, 258, 819, 468]
	    Open		    off
	    ToolBar		    off
	    StatusBar		    off
	    ScreenColor		    white
	    PaperOrientation	    landscape
	    PaperPositionMode	    auto
	    PaperType		    usletter
	    PaperUnits		    inches
	    Block {
	      BlockType		      Inport
	      Name		      "SOC"
	      Position		      [75, 85, 95, 105]
	      Port		      "1"
	      PortWidth		      "-1"
	      SampleTime	      "-1"
	    }
	    Block {
	      BlockType		      EnablePort
	      Name		      "Enable"
	      Ports		      [0, 0, 0, 0, 0]
	      Position		      [170, 25, 190, 45]
	      StatesWhenEnabling      held
	      ShowOutputPort	      off
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [95, 145, 165, 165]
	      Orientation	      up
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      ".001"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [185, 88, 215, 112]
	      Operator		      "<"
	    }
	    Block {
	      BlockType		      Stop
	      Name		      "Stop Simulation"
	      Position		      [255, 83, 295, 117]
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      Points		      [0, -35]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "SOC"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      DstBlock		      "Stop Simulation"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Outport
	  Name			  "power available\nto bus (W)"
	  Position		  [870, 85, 890, 105]
	  FontName		  "Arial"
	  Port			  "1"
	  OutputWhenDisabled	  held
	  InitialOutput		  "0"
	}
	Line {
	  SrcBlock		  "Mux"
	  SrcPort		  1
	  DstBlock		  "Discharge Model\nOutputs:\nPreq(W)\nPavail "
"(W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Discharge Model\nOutputs:\nPreq(W)\nPavail "
"(W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	  SrcPort		  1
	  DstBlock		  "Demux"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  5
	  Points		  [20, 0]
	  DstBlock		  "Memory1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  4
	  Points		  [35, 0]
	  DstBlock		  "To Workspace10"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  2
	  Points		  [30, 0]
	  DstBlock		  "# batteries"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Clock"
	  SrcPort		  1
	  Points		  [45, 0]
	  DstBlock		  "Mux"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "power req'd\ninto bus (W)"
	  SrcPort		  1
	  Points		  [95, 0]
	  Branch {
	    DstBlock		    "To Workspace8"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "1/# batteries"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "pzero"
	  SrcPort		  1
	  DstBlock		  "Switch"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "Relational\nOperator"
	  SrcPort		  1
	  Points		  [0, -20]
	  DstBlock		  "Switch"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "soc"
	  SrcPort		  1
	  DstBlock		  "Relational\nOperator"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "1/# batteries"
	  SrcPort		  1
	  Points		  [45, 0]
	  DstBlock		  "Switch"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Switch"
	  SrcPort		  1
	  Points		  [35, 0; 0, -25]
	  DstBlock		  "Mux"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  1
	  Points		  [0, -45]
	  DstBlock		  "Terminator1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "# batteries"
	  SrcPort		  1
	  Points		  [45, 0]
	  Branch {
	    DstBlock		    "To Workspace9"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "power available\nto bus (W)"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "# batteries1"
	  SrcPort		  1
	  DstBlock		  "Memory"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  3
	  DstBlock		  "# batteries1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Memory"
	  SrcPort		  1
	  Points		  [5, 0]
	  Branch {
	    DstBlock		    "To Workspace11"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "Goto <mc>, <gc>, <sdo>"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "Memory1"
	  SrcPort		  1
	  Points		  [15, 0; 0, 5]
	  Branch {
	    Points		    [0, 25]
	    Branch {
	      Points		      [-425, 0; 0, -90]
	      DstBlock		      "Relational\nOperator"
	      DstPort		      1
	    }
	    Branch {
	      Points		      [10, 0]
	      Branch {
		DstBlock		"stop sim"
		DstPort			1
	      }
	      Branch {
		Points			[0, 35]
		DstBlock		"max pack\npwr (W)"
		DstPort			1
	      }
	    }
	  }
	  Branch {
	    DstBlock		    "Goto <sdo>, <cs>"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "Temp (in C)"
	  SrcPort		  1
	  DstBlock		  "Sum1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "C->K"
	  SrcPort		  1
	  Points		  [10, 0]
	  DstBlock		  "Sum1"
	  DstPort		  2
	}
	Line {
	  SrcBlock		  "Sum1"
	  SrcPort		  1
	  DstBlock		  "Mux"
	  DstPort		  3
	}
	Line {
	  SrcBlock		  "Const"
	  SrcPort		  1
	  DstBlock		  "stop sim"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "max pack\npwr (W)"
	  SrcPort		  1
	  DstBlock		  "Goto <cs>1"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "Demux"
	  SrcPort		  6
	  Points		  [0, 265; 90, 0]
	  Branch {
	    DstBlock		    "ess tmp"
	    DstPort		    1
	  }
	  Branch {
	    DstBlock		    "To WS1"
	    DstPort		    1
	  }
	}
	Line {
	  SrcBlock		  "do ess calcs?"
	  SrcPort		  1
	  DstBlock		  "ess tmp"
	  DstPort		  enable
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  2
	  DstBlock		  "To WS3"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  3
	  DstBlock		  "To WS4"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "ess tmp"
	  SrcPort		  1
	  Points		  [0, 0]
	  Branch {
	    DstBlock		    "To WS2"
	    DstPort		    1
	  }
	  Branch {
	    Points		    [0, -45; -250, 0]
	    DstBlock		    "Temp (in C)"
	    DstPort		    1
	  }
	}
      }
    }
    Annotation {
      Position		      [46, 232]
      Text		      "Nnet"
    }
    Annotation {
      Position		      [81, 391]
      Text		      "Fundamental"
    }
    Annotation {
      Position		      [64, 40]
      Text		      "Advisor 2.2"
    }
  }
}
